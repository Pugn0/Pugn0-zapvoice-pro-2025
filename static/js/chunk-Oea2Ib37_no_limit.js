var dt=Object.defineProperty;var ut=(l,e,r)=>e in l?dt(l,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):l[e]=r;var d=(l,e,r)=>ut(l,typeof e!="symbol"?e+"":e,r);import{c as J,p as Q,b as ee,a as c,u as L,h as be,g as Le}from"./chunk-CdV9K1BU.js";let pe;const ct=new Uint8Array(16);function lt(){if(!pe&&(pe=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!pe))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return pe(ct)}const Y=[];for(let l=0;l<256;++l)Y.push((l+256).toString(16).slice(1));function ht(l,e=0){return Y[l[e+0]]+Y[l[e+1]]+Y[l[e+2]]+Y[l[e+3]]+"-"+Y[l[e+4]]+Y[l[e+5]]+"-"+Y[l[e+6]]+Y[l[e+7]]+"-"+Y[l[e+8]]+Y[l[e+9]]+"-"+Y[l[e+10]]+Y[l[e+11]]+Y[l[e+12]]+Y[l[e+13]]+Y[l[e+14]]+Y[l[e+15]]}const gt=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),$e={randomUUID:gt};function et(l,e,r){if($e.randomUUID&&!e&&!l)return $e.randomUUID();l=l||{};const i=l.random||(l.rng||lt)();return i[6]=i[6]&15|64,i[8]=i[8]&63|128,ht(i)}class X{constructor(e){d(this,"value");this.value=e??et()}toString(){return String(this.value)}toValue(){return this.value}equals(e){return e.toValue()===this.value}}function A(l,e={toLowerCase:!0}){const r=l.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\x00-\x7F]/g,"").trim();return e.toLowerCase?r.toLowerCase():r}class ne{constructor(e,r){d(this,"_id");d(this,"props");this.props=e,this._id=r??new X}get id(){return this._id.toValue()}get idEntity(){return this._id}equals(e){return!!(e===this||e.idEntity.equals(this._id))}}class Fe extends ne{get asViewOnce(){return this.props.asViewOnce}set asViewOnce(e){this.props.asViewOnce=e}get data(){return this.props.data}set data(e){this.props.data=e}get isFavorite(){return this.props.isFavorite}set isFavorite(e){this.props.isFavorite=e}get isPtt(){return this.props.isPtt}set isPtt(e){this.props.isPtt=e}get name(){return this.props.name}set name(e){this.props.name=e}get metadata(){return{data:this.props.data,id:this.id,isFavorite:this.props.isFavorite,isPtt:this.props.isPtt,name:this.props.name}}static create(e,r){return new Fe(e,r)}}const mt={audioList:[],dummyTrigger:!1,filterTerm:"",selectedAudioId:""},Re="ZV:audioStore";class Ts{constructor(e,r={shouldMigrate:!1}){d(this,"_store");d(this,"useDashboardAudioList",()=>L(this.store,e=>{const r=e.filterTerm,i=r.trim().length>0?e.audioList.filter(t=>A(t.name,{toLowerCase:!0}).includes(A(r,{toLowerCase:!0}))):e.audioList,n=e.selectedAudioId;return{filterTerm:r,filteredAudioList:i,selectedAudioId:n}}));d(this,"useGetAudioList",()=>L(this.store,e=>e.audioList));d(this,"useGetAudioCount",()=>L(this.store,e=>e.audioList.length));d(this,"useGetFilteredAudioList",()=>L(this.store,e=>e.audioList.filter(r=>A(r.name,{toLowerCase:!0}).includes(A(e.filterTerm,{toLowerCase:!0})))));d(this,"useGetHasAudios",()=>L(this.store,e=>e.audioList.length>0));d(this,"useGetFilterTerm",()=>L(this.store,e=>e.filterTerm));d(this,"useGetSelectedAudioId",()=>L(this.store,e=>({selectedAudioId:e.selectedAudioId,dummyTrigger:e.dummyTrigger})));d(this,"addAudio",(...e)=>c.unstable_batchedUpdates(()=>this.store.getState().addAudio(...e)));d(this,"deleteAudio",(...e)=>c.unstable_batchedUpdates(()=>this.store.getState().deleteAudio(...e)));d(this,"findById",(...e)=>c.unstable_batchedUpdates(()=>this.store.getState().findById(...e)));d(this,"getAudioDataById",(...e)=>c.unstable_batchedUpdates(()=>this.store.getState().getAudioDataById(...e)));d(this,"reorderAudioList",(...e)=>c.unstable_batchedUpdates(()=>this.store.getState().reorderAudioList(...e)));d(this,"saveAudio",(...e)=>c.unstable_batchedUpdates(()=>this.store.getState().saveAudio(...e)));d(this,"selectAudio",(...e)=>c.unstable_batchedUpdates(()=>this.store.getState().selectAudio(...e)));d(this,"setAudioFilter",(...e)=>c.unstable_batchedUpdates(()=>this.store.getState().setAudioFilter(...e)));d(this,"toggleAudioIsFavorite",(...e)=>c.unstable_batchedUpdates(()=>this.store.getState().toggleAudioIsFavorite(...e)));this.zustandStorage=e,this.options=r,this._store=J()(Q((i,n)=>({...mt,toggleDummy:()=>i(t=>({dummyTrigger:!t.dummyTrigger})),addAudio:async t=>{await this.zustandStorage.setItem(t.id,{data:t.data,isPtt:t.isPtt}),i(s=>({audioList:[...s.audioList,{asViewOnce:!!t.asViewOnce,id:t.id.toString(),isFavorite:!!t.isFavorite,isPtt:t.isPtt,name:t.name}],filterTerm:"",selectedAudioId:t.id}))},deleteAudio:async t=>{i(s=>({audioList:s.audioList.filter(a=>a.id!==t),selectedAudioId:"",filterTerm:""})),await this.zustandStorage.removeItem(t)},findById:async t=>{const s=await this.getAudioDataById(t),a=n().audioList.find(o=>o.id===t);return a?Fe.create({asViewOnce:a.asViewOnce,data:s?s.data:"",isFavorite:a.isFavorite,isPtt:a.isPtt,name:a.name},new X(t)):null},getAudioDataById:async t=>{let s=null;const a=await this.zustandStorage.getParsedItem(t),o=n().audioList.find(u=>u.id===t);return a&&o&&(s={...a,isPtt:o.isPtt}),s},reorderAudioList:async t=>{const{sourceIndex:s,destinationIndex:a}=t,o=n().audioList,u=o.splice(s,1);o.splice(a,0,...u),i({audioList:o,dummyTrigger:!n().dummyTrigger})},saveAudio:async t=>{await this.zustandStorage.setItem(t.id,{data:t.data,isPtt:t.isPtt}),i(a=>({audioList:a.audioList.map(o=>{var u;if(o.id===t.id){const h=((u=t.name)==null?void 0:u.trim())??"";return{asViewOnce:t.asViewOnce??o.asViewOnce,id:t.id,isFavorite:t.isFavorite??o.isFavorite,isPtt:t.isPtt??o.isPtt,name:h===""?o.name:h}}return o})}));const s=n().selectedAudioId;s&&t.id===s&&n().toggleDummy()},selectAudio:async t=>i({selectedAudioId:t}),setAudioFilter:async t=>{i({filterTerm:t.trim()})},toggleAudioIsFavorite:async t=>{i(s=>({audioList:s.audioList.map(a=>a.id===t?{...a,isFavorite:!a.isFavorite}:a)}))}}),{name:Re,storage:ee(()=>this.zustandStorage),version:0})),this.options.shouldMigrate&&this.validateAudioMigration(),this.zustandStorage.addStorageListener(async()=>{await this.rehydrateStore()},[Re])}async rehydrateStore(){setTimeout(async()=>{await this._store.persist.rehydrate()},300);try{JSON.parse(localStorage.getItem("ZV:cachedAudioIds")||"[]").forEach(r=>{localStorage.removeItem(r.id)}),localStorage.removeItem("ZV:cachedAudioIds")}catch{}}get store(){return this._store}get audioList(){return c.unstable_batchedUpdates(()=>this.store.getState().audioList)}get audioCount(){return c.unstable_batchedUpdates(()=>this.store.getState().audioList.length)}get filteredAudioList(){return c.unstable_batchedUpdates(()=>{const e=this.store.getState().filterTerm;return this.store.getState().audioList.filter(i=>A(i.name,{toLowerCase:!0}).includes(A(e,{toLowerCase:!0})))})}get hasAudios(){return c.unstable_batchedUpdates(()=>this.store.getState().audioList.length>0)}get filterTerm(){return c.unstable_batchedUpdates(()=>this.store.getState().filterTerm)}get selectedAudioId(){return c.unstable_batchedUpdates(()=>this.store.getState().selectedAudioId)}async migrateFromOldSchema(e){this.store.setState({audioList:e.map(r=>({asViewOnce:!1,id:r.id,isFavorite:!1,isPtt:!0,name:r.name}))})}async validateAudioMigration(e=!1){const r="migratedAudioSchema",i=await this.zustandStorage.getParsedItem(r);if(i)return;const n="audiosIndex",t=this.store.getState().audioList;if(t.length>0&&e===!1)return;const a=await this.zustandStorage.getParsedItem(n);(!!(t.length===0&&a&&a.length>0)&&!i||e)&&(await this.migrateFromOldSchema(a??[]),await this.zustandStorage.setItem(r,"true")),e&&(e=!1)}}class Ae extends ne{get name(){return this.props.name}set name(e){this.props.name=e}get data(){return this.props.data}set data(e){this.props.data=e}get fileName(){return this.props.fileName}set fileName(e){this.props.fileName=e}get isFavorite(){return this.props.isFavorite}set isFavorite(e){this.props.isFavorite=e}get metadata(){return{id:this.id,name:this.props.name,data:this.props.data,fileName:this.props.fileName,isFavorite:this.props.isFavorite}}static create(e,r){return new Ae(e,r)}}const pt={documentList:[],dummyTrigger:!1,filterTerm:"",selectedDocumentId:""},ze="ZV:documentStore",ft="docsIndex";class _s{constructor(e,r={shouldMigrate:!1}){d(this,"_store");d(this,"useGetDocumentList",()=>L(this.store,e=>e.documentList));d(this,"useGetDocumentCount",()=>L(this.store,e=>e.documentList.length));d(this,"useGetFilteredDocumentList",()=>L(this.store,e=>e.documentList.filter(r=>A(r.name,{toLowerCase:!0}).includes(A(e.filterTerm,{toLowerCase:!0})))));d(this,"useGetHasDocuments",()=>L(this.store,e=>e.documentList.length>0));d(this,"useGetFilterTerm",()=>L(this.store,e=>e.filterTerm));d(this,"useGetSelectedDocument",()=>L(this.store,e=>({selectedDocumentId:e.selectedDocumentId,dummyTrigger:e.dummyTrigger})));d(this,"useDashboardDocumentList",()=>L(this.store,e=>{const r=e.filterTerm,i=r.trim().length>0?e.documentList.filter(t=>A(t.name,{toLowerCase:!0}).includes(A(r,{toLowerCase:!0}))):e.documentList,n=e.selectedDocumentId;return{filteredDocumentList:i,filterTerm:r,selectedDocumentId:n}}));d(this,"addDocument",(...e)=>c.unstable_batchedUpdates(()=>this.store.getState().addDocument(...e)));d(this,"deleteDocument",(...e)=>c.unstable_batchedUpdates(()=>this.store.getState().deleteDocument(...e)));d(this,"findById",(...e)=>c.unstable_batchedUpdates(()=>this.store.getState().findById(...e)));d(this,"getDocumentDataById",(...e)=>c.unstable_batchedUpdates(()=>this.store.getState().getDocumentDataById(...e)));d(this,"reorderDocumentList",(...e)=>c.unstable_batchedUpdates(()=>this.store.getState().reorderDocumentList(...e)));d(this,"saveDocument",(...e)=>c.unstable_batchedUpdates(()=>this.store.getState().saveDocument(...e)));d(this,"selectDocument",(...e)=>c.unstable_batchedUpdates(()=>this.store.getState().selectDocument(...e)));d(this,"setDocumentFilter",(...e)=>c.unstable_batchedUpdates(()=>this.store.getState().setDocumentFilter(...e)));d(this,"toggleDocumentIsFavorite",(...e)=>c.unstable_batchedUpdates(()=>this.store.getState().toggleDocumentIsFavorite(...e)));this.zustandStorage=e,this.options=r,this._store=J()(Q((i,n)=>({...pt,toggleDummy:()=>i(t=>({dummyTrigger:!t.dummyTrigger})),addDocument:async t=>{await this.zustandStorage.setItem(t.id,{data:t.data,fileName:t.fileName}),i(s=>({documentList:[...s.documentList,{id:t.id.toString(),isFavorite:t.isFavorite,name:t.name}],filterTerm:"",selectedDocumentId:t.id}))},deleteDocument:async t=>{i(s=>({documentList:s.documentList.filter(a=>a.id!==t),selectedDocumentId:"",filterTerm:""})),await this.zustandStorage.removeItem(t)},findById:async t=>{const s=await this.getDocumentDataById(t),a=n().documentList.find(o=>o.id===t);return a&&(s||s==="")?Ae.create({data:s.data,fileName:s.fileName,isFavorite:a.isFavorite,name:a.name},new X(t)):null},getDocumentDataById:async t=>{let s=null;const a=await this.zustandStorage.getParsedItem(t);return typeof(a==null?void 0:a.data)=="string"&&typeof a.fileName=="string"&&(s=a),s},reorderDocumentList:async t=>{const{sourceIndex:s,destinationIndex:a}=t,o=n().documentList,u=o.splice(s,1);o.splice(a,0,...u),i({documentList:o})},saveDocument:async t=>{await this.zustandStorage.setItem(t.id,{data:t.data,fileName:t.fileName}),i(a=>({documentList:a.documentList.map(o=>{var u;if(o.id===t.id){const h=((u=t.name)==null?void 0:u.trim())??"";return{id:t.id,isFavorite:t.isFavorite??o.isFavorite,name:h===""?o.name:h}}return o})}));const s=n().selectedDocumentId;s&&t.id===s&&n().toggleDummy()},selectDocument:async t=>i({selectedDocumentId:t}),setDocumentFilter:async t=>{i({filterTerm:t.trim()})},toggleDocumentIsFavorite:async t=>{i(s=>({documentList:s.documentList.map(a=>a.id===t?{...a,isFavorite:!a.isFavorite}:a)}))}}),{name:ze,storage:ee(()=>this.zustandStorage),version:0})),this.options.shouldMigrate&&this.validateDocumentMigration(),this.zustandStorage.addStorageListener(async()=>{await this.rehydrateStore()},[ze])}async rehydrateStore(){setTimeout(async()=>{await this._store.persist.rehydrate()},300);try{JSON.parse(localStorage.getItem("ZV:cachedDocumentIds")||"[]").forEach(r=>{localStorage.removeItem(r.id)}),localStorage.removeItem("ZV:cachedDocumentIds")}catch{}}get store(){return this._store}get documentList(){return c.unstable_batchedUpdates(()=>this.store.getState().documentList)}get documentCount(){return c.unstable_batchedUpdates(()=>this.store.getState().documentList.length)}get filteredDocumentList(){return c.unstable_batchedUpdates(()=>{const e=this.store.getState().filterTerm,r=this.store.getState().documentList;return e?r.filter(i=>A(i.name,{toLowerCase:!0}).includes(A(e,{toLowerCase:!0}))):r})}get hasDocuments(){return c.unstable_batchedUpdates(()=>this.store.getState().documentList.length>0)}get filterTerm(){return c.unstable_batchedUpdates(()=>this.store.getState().filterTerm)}get selectedDocument(){return c.unstable_batchedUpdates(()=>this.store.getState().selectedDocumentId)}async migrateFromOldSchema(e){this.store.setState({documentList:e.map(r=>({id:r.id,name:r.name,isFavorite:!1}))})}async validateDocumentMigration(e=!1){const r="migratedDocsSchema",i=await this.zustandStorage.getParsedItem(r);if(i)return;const n=this._store.getState().documentList;if(n.length>0&&e===!1)return;const s=await this.zustandStorage.getParsedItem(ft);(!!(n.length===0&&s&&s.length>0)&&!i||e)&&(await this.zustandStorage.setItem(r,"true"),await this.migrateFromOldSchema(s??[])),e&&(e=!1)}}class w extends ne{constructor(r,i){super(r,i);d(this,"_expirationTimeoutInMs");d(this,"_flowId");d(this,"_nextNodeIds");d(this,"_nextNodeIdOnExpiration");d(this,"_position");d(this,"_type");this._expirationTimeoutInMs=r.expirationTimeoutInMs,this._flowId=r.flowId,this._nextNodeIds=r.nextNodeIds,this._nextNodeIdOnExpiration=r.nextNodeIdOnExpiration,this._position=r.position,this._type=r.type}get expirationTimeoutInMs(){return this._expirationTimeoutInMs??null}get flowId(){return this._flowId}get nextNodeIds(){return this._nextNodeIds}get nextNodeIdOnExpiration(){return this._nextNodeIdOnExpiration??null}get position(){return this._position}get type(){return this._type}static is(r,i){return typeof r=="object"&&r!==null&&"type"in r&&r.type===i}static isControlNode(r){return w.isDelayNode(r)||w.isUserInputNode(r)}static isStartNode(r){return w.is(r,"start")}static isUserInputNode(r){return w.is(r,"user-input")}static isDelayNode(r){return w.is(r,"delay")}static isAudioNode(r){return w.is(r,"audio")}static isContactNode(r){return w.is(r,"contact")}static isDocumentNode(r){return w.is(r,"document")}static isMediaNode(r){return w.is(r,"media")}static isTextNode(r){return w.is(r,"text")}static isItemNode(r){return w.is(r,"audio")||w.is(r,"document")||w.is(r,"media")||w.is(r,"text")}}var tt={exports:{}};(function(l,e){(function(r,i){l.exports=i()})(be,function(){var r=1e3,i=6e4,n=36e5,t="millisecond",s="second",a="minute",o="hour",u="day",h="week",g="month",f="quarter",m="year",v="date",k="Invalid Date",I=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,U=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,M={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(x){var y=["th","st","nd","rd"],p=x%100;return"["+x+(y[(p-20)%10]||y[p]||y[0])+"]"}},D=function(x,y,p){var b=String(x);return!b||b.length>=y?x:""+Array(y+1-b.length).join(p)+x},B={s:D,z:function(x){var y=-x.utcOffset(),p=Math.abs(y),b=Math.floor(p/60),S=p%60;return(y<=0?"+":"-")+D(b,2,"0")+":"+D(S,2,"0")},m:function x(y,p){if(y.date()<p.date())return-x(p,y);var b=12*(p.year()-y.year())+(p.month()-y.month()),S=y.clone().add(b,g),T=p-S<0,_=y.clone().add(b+(T?-1:1),g);return+(-(b+(p-S)/(T?S-_:_-S))||0)},a:function(x){return x<0?Math.ceil(x)||0:Math.floor(x)},p:function(x){return{M:g,y:m,w:h,d:u,D:v,h:o,m:a,s,ms:t,Q:f}[x]||String(x||"").toLowerCase().replace(/s$/,"")},u:function(x){return x===void 0}},O="en",V={};V[O]=M;var W="$isDayjsObject",$=function(x){return x instanceof H||!(!x||!x[W])},R=function x(y,p,b){var S;if(!y)return O;if(typeof y=="string"){var T=y.toLowerCase();V[T]&&(S=T),p&&(V[T]=p,S=T);var _=y.split("-");if(!S&&_.length>1)return x(_[0])}else{var E=y.name;V[E]=y,S=E}return!b&&S&&(O=S),S||!b&&O},N=function(x,y){if($(x))return x.clone();var p=typeof y=="object"?y:{};return p.date=x,p.args=arguments,new H(p)},F=B;F.l=R,F.i=$,F.w=function(x,y){return N(x,{locale:y.$L,utc:y.$u,x:y.$x,$offset:y.$offset})};var H=function(){function x(p){this.$L=R(p.locale,null,!0),this.parse(p),this.$x=this.$x||p.x||{},this[W]=!0}var y=x.prototype;return y.parse=function(p){this.$d=function(b){var S=b.date,T=b.utc;if(S===null)return new Date(NaN);if(F.u(S))return new Date;if(S instanceof Date)return new Date(S);if(typeof S=="string"&&!/Z$/i.test(S)){var _=S.match(I);if(_){var E=_[2]-1||0,C=(_[7]||"0").substring(0,3);return T?new Date(Date.UTC(_[1],E,_[3]||1,_[4]||0,_[5]||0,_[6]||0,C)):new Date(_[1],E,_[3]||1,_[4]||0,_[5]||0,_[6]||0,C)}}return new Date(S)}(p),this.init()},y.init=function(){var p=this.$d;this.$y=p.getFullYear(),this.$M=p.getMonth(),this.$D=p.getDate(),this.$W=p.getDay(),this.$H=p.getHours(),this.$m=p.getMinutes(),this.$s=p.getSeconds(),this.$ms=p.getMilliseconds()},y.$utils=function(){return F},y.isValid=function(){return this.$d.toString()!==k},y.isSame=function(p,b){var S=N(p);return this.startOf(b)<=S&&S<=this.endOf(b)},y.isAfter=function(p,b){return N(p)<this.startOf(b)},y.isBefore=function(p,b){return this.endOf(b)<N(p)},y.$g=function(p,b,S){return F.u(p)?this[b]:this.set(S,p)},y.unix=function(){return Math.floor(this.valueOf()/1e3)},y.valueOf=function(){return this.$d.getTime()},y.startOf=function(p,b){var S=this,T=!!F.u(b)||b,_=F.p(p),E=function(te,G){var q=F.w(S.$u?Date.UTC(S.$y,G,te):new Date(S.$y,G,te),S);return T?q:q.endOf(u)},C=function(te,G){return F.w(S.toDate()[te].apply(S.toDate("s"),(T?[0,0,0,0]:[23,59,59,999]).slice(G)),S)},P=this.$W,z=this.$M,Z=this.$D,oe="set"+(this.$u?"UTC":"");switch(_){case m:return T?E(1,0):E(31,11);case g:return T?E(1,z):E(0,z+1);case h:var ie=this.$locale().weekStart||0,ce=(P<ie?P+7:P)-ie;return E(T?Z-ce:Z+(6-ce),z);case u:case v:return C(oe+"Hours",0);case o:return C(oe+"Minutes",1);case a:return C(oe+"Seconds",2);case s:return C(oe+"Milliseconds",3);default:return this.clone()}},y.endOf=function(p){return this.startOf(p,!1)},y.$set=function(p,b){var S,T=F.p(p),_="set"+(this.$u?"UTC":""),E=(S={},S[u]=_+"Date",S[v]=_+"Date",S[g]=_+"Month",S[m]=_+"FullYear",S[o]=_+"Hours",S[a]=_+"Minutes",S[s]=_+"Seconds",S[t]=_+"Milliseconds",S)[T],C=T===u?this.$D+(b-this.$W):b;if(T===g||T===m){var P=this.clone().set(v,1);P.$d[E](C),P.init(),this.$d=P.set(v,Math.min(this.$D,P.daysInMonth())).$d}else E&&this.$d[E](C);return this.init(),this},y.set=function(p,b){return this.clone().$set(p,b)},y.get=function(p){return this[F.p(p)]()},y.add=function(p,b){var S,T=this;p=Number(p);var _=F.p(b),E=function(z){var Z=N(T);return F.w(Z.date(Z.date()+Math.round(z*p)),T)};if(_===g)return this.set(g,this.$M+p);if(_===m)return this.set(m,this.$y+p);if(_===u)return E(1);if(_===h)return E(7);var C=(S={},S[a]=i,S[o]=n,S[s]=r,S)[_]||1,P=this.$d.getTime()+p*C;return F.w(P,this)},y.subtract=function(p,b){return this.add(-1*p,b)},y.format=function(p){var b=this,S=this.$locale();if(!this.isValid())return S.invalidDate||k;var T=p||"YYYY-MM-DDTHH:mm:ssZ",_=F.z(this),E=this.$H,C=this.$m,P=this.$M,z=S.weekdays,Z=S.months,oe=S.meridiem,ie=function(G,q,ae,de){return G&&(G[q]||G(b,T))||ae[q].slice(0,de)},ce=function(G){return F.s(E%12||12,G,"0")},te=oe||function(G,q,ae){var de=G<12?"AM":"PM";return ae?de.toLowerCase():de};return T.replace(U,function(G,q){return q||function(ae){switch(ae){case"YY":return String(b.$y).slice(-2);case"YYYY":return F.s(b.$y,4,"0");case"M":return P+1;case"MM":return F.s(P+1,2,"0");case"MMM":return ie(S.monthsShort,P,Z,3);case"MMMM":return ie(Z,P);case"D":return b.$D;case"DD":return F.s(b.$D,2,"0");case"d":return String(b.$W);case"dd":return ie(S.weekdaysMin,b.$W,z,2);case"ddd":return ie(S.weekdaysShort,b.$W,z,3);case"dddd":return z[b.$W];case"H":return String(E);case"HH":return F.s(E,2,"0");case"h":return ce(1);case"hh":return ce(2);case"a":return te(E,C,!0);case"A":return te(E,C,!1);case"m":return String(C);case"mm":return F.s(C,2,"0");case"s":return String(b.$s);case"ss":return F.s(b.$s,2,"0");case"SSS":return F.s(b.$ms,3,"0");case"Z":return _}return null}(G)||_.replace(":","")})},y.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},y.diff=function(p,b,S){var T,_=this,E=F.p(b),C=N(p),P=(C.utcOffset()-this.utcOffset())*i,z=this-C,Z=function(){return F.m(_,C)};switch(E){case m:T=Z()/12;break;case g:T=Z();break;case f:T=Z()/3;break;case h:T=(z-P)/6048e5;break;case u:T=(z-P)/864e5;break;case o:T=z/n;break;case a:T=z/i;break;case s:T=z/r;break;default:T=z}return S?T:F.a(T)},y.daysInMonth=function(){return this.endOf(g).$D},y.$locale=function(){return V[this.$L]},y.locale=function(p,b){if(!p)return this.$L;var S=this.clone(),T=R(p,b,!0);return T&&(S.$L=T),S},y.clone=function(){return F.w(this.$d,this)},y.toDate=function(){return new Date(this.valueOf())},y.toJSON=function(){return this.isValid()?this.toISOString():null},y.toISOString=function(){return this.$d.toISOString()},y.toString=function(){return this.$d.toUTCString()},x}(),j=H.prototype;return N.prototype=j,[["$ms",t],["$s",s],["$m",a],["$H",o],["$W",u],["$M",g],["$y",m],["$D",v]].forEach(function(x){j[x[1]]=function(y){return this.$g(y,x[0],x[1])}}),N.extend=function(x,y){return x.$i||(x(y,H,N),x.$i=!0),N},N.locale=R,N.isDayjs=$,N.unix=function(x){return N(1e3*x)},N.en=V[O],N.Ls=V,N.p={},N})})(tt);var yt=tt.exports;const K=Le(yt);var st={exports:{}};(function(l,e){(function(r,i){l.exports=i()})(be,function(){return function(r,i,n){i.prototype.isBetween=function(t,s,a,o){var u=n(t),h=n(s),g=(o=o||"()")[0]==="(",f=o[1]===")";return(g?this.isAfter(u,a):!this.isBefore(u,a))&&(f?this.isBefore(h,a):!this.isAfter(h,a))||(g?this.isBefore(u,a):!this.isAfter(u,a))&&(f?this.isAfter(h,a):!this.isBefore(h,a))}}})})(st);var St=st.exports;const It=Le(St);var rt={exports:{}};(function(l,e){(function(r,i){l.exports=i()})(be,function(){var r="day";return function(i,n,t){var s=function(u){return u.add(4-u.isoWeekday(),r)},a=n.prototype;a.isoWeekYear=function(){return s(this).year()},a.isoWeek=function(u){if(!this.$utils().u(u))return this.add(7*(u-this.isoWeek()),r);var h,g,f,m,v=s(this),k=(h=this.isoWeekYear(),g=this.$u,f=(g?t.utc:t)().year(h).startOf("year"),m=4-f.isoWeekday(),f.isoWeekday()>4&&(m+=7),f.add(m,r));return v.diff(k,"week")+1},a.isoWeekday=function(u){return this.$utils().u(u)?this.day()||7:this.day(this.day()%7?u:u-7)};var o=a.startOf;a.startOf=function(u,h){var g=this.$utils(),f=!!g.u(h)||h;return g.p(u)==="isoweek"?f?this.date(this.date()-(this.isoWeekday()-1)).startOf("day"):this.date(this.date()-1-(this.isoWeekday()-1)+7).endOf("day"):o.bind(this)(u,h)}}})})(rt);var bt=rt.exports;const Lt=Le(bt);var it={exports:{}};(function(l,e){(function(r,i){l.exports=i()})(be,function(){var r={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},i=/(\[[^[]*\])|([-_:/.,()\s]+)|(A|a|Q|YYYY|YY?|ww?|MM?M?M?|Do|DD?|hh?|HH?|mm?|ss?|S{1,3}|z|ZZ?)/g,n=/\d/,t=/\d\d/,s=/\d\d?/,a=/\d*[^-_:/,()\s\d]+/,o={},u=function(I){return(I=+I)+(I>68?1900:2e3)},h=function(I){return function(U){this[I]=+U}},g=[/[+-]\d\d:?(\d\d)?|Z/,function(I){(this.zone||(this.zone={})).offset=function(U){if(!U||U==="Z")return 0;var M=U.match(/([+-]|\d\d)/g),D=60*M[1]+(+M[2]||0);return D===0?0:M[0]==="+"?-D:D}(I)}],f=function(I){var U=o[I];return U&&(U.indexOf?U:U.s.concat(U.f))},m=function(I,U){var M,D=o.meridiem;if(D){for(var B=1;B<=24;B+=1)if(I.indexOf(D(B,0,U))>-1){M=B>12;break}}else M=I===(U?"pm":"PM");return M},v={A:[a,function(I){this.afternoon=m(I,!1)}],a:[a,function(I){this.afternoon=m(I,!0)}],Q:[n,function(I){this.month=3*(I-1)+1}],S:[n,function(I){this.milliseconds=100*+I}],SS:[t,function(I){this.milliseconds=10*+I}],SSS:[/\d{3}/,function(I){this.milliseconds=+I}],s:[s,h("seconds")],ss:[s,h("seconds")],m:[s,h("minutes")],mm:[s,h("minutes")],H:[s,h("hours")],h:[s,h("hours")],HH:[s,h("hours")],hh:[s,h("hours")],D:[s,h("day")],DD:[t,h("day")],Do:[a,function(I){var U=o.ordinal,M=I.match(/\d+/);if(this.day=M[0],U)for(var D=1;D<=31;D+=1)U(D).replace(/\[|\]/g,"")===I&&(this.day=D)}],w:[s,h("week")],ww:[t,h("week")],M:[s,h("month")],MM:[t,h("month")],MMM:[a,function(I){var U=f("months"),M=(f("monthsShort")||U.map(function(D){return D.slice(0,3)})).indexOf(I)+1;if(M<1)throw new Error;this.month=M%12||M}],MMMM:[a,function(I){var U=f("months").indexOf(I)+1;if(U<1)throw new Error;this.month=U%12||U}],Y:[/[+-]?\d+/,h("year")],YY:[t,function(I){this.year=u(I)}],YYYY:[/\d{4}/,h("year")],Z:g,ZZ:g};function k(I){var U,M;U=I,M=o&&o.formats;for(var D=(I=U.replace(/(\[[^\]]+])|(LTS?|l{1,4}|L{1,4})/g,function(N,F,H){var j=H&&H.toUpperCase();return F||M[H]||r[H]||M[j].replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,function(x,y,p){return y||p.slice(1)})})).match(i),B=D.length,O=0;O<B;O+=1){var V=D[O],W=v[V],$=W&&W[0],R=W&&W[1];D[O]=R?{regex:$,parser:R}:V.replace(/^\[|\]$/g,"")}return function(N){for(var F={},H=0,j=0;H<B;H+=1){var x=D[H];if(typeof x=="string")j+=x.length;else{var y=x.regex,p=x.parser,b=N.slice(j),S=y.exec(b)[0];p.call(F,S),N=N.replace(S,"")}}return function(T){var _=T.afternoon;if(_!==void 0){var E=T.hours;_?E<12&&(T.hours+=12):E===12&&(T.hours=0),delete T.afternoon}}(F),F}}return function(I,U,M){M.p.customParseFormat=!0,I&&I.parseTwoDigitYear&&(u=I.parseTwoDigitYear);var D=U.prototype,B=D.parse;D.parse=function(O){var V=O.date,W=O.utc,$=O.args;this.$u=W;var R=$[1];if(typeof R=="string"){var N=$[2]===!0,F=$[3]===!0,H=N||F,j=$[2];F&&(j=$[2]),o=this.$locale(),!N&&j&&(o=M.Ls[j]),this.$d=function(b,S,T,_){try{if(["x","X"].indexOf(S)>-1)return new Date((S==="X"?1e3:1)*b);var E=k(S)(b),C=E.year,P=E.month,z=E.day,Z=E.hours,oe=E.minutes,ie=E.seconds,ce=E.milliseconds,te=E.zone,G=E.week,q=new Date,ae=z||(C||P?1:q.getDate()),de=C||q.getFullYear(),ge=0;C&&!P||(ge=P>0?P-1:q.getMonth());var me,Te=Z||0,_e=oe||0,ve=ie||0,Me=ce||0;return te?new Date(Date.UTC(de,ge,ae,Te,_e,ve,Me+60*te.offset*1e3)):T?new Date(Date.UTC(de,ge,ae,Te,_e,ve,Me)):(me=new Date(de,ge,ae,Te,_e,ve,Me),G&&(me=_(me).week(G).toDate()),me)}catch{return new Date("")}}(V,R,W,M),this.init(),j&&j!==!0&&(this.$L=this.locale(j).$L),H&&V!=this.format(R)&&(this.$d=new Date("")),o={}}else if(R instanceof Array)for(var x=R.length,y=1;y<=x;y+=1){$[1]=R[y-1];var p=M.apply(this,$);if(p.isValid()){this.$d=p.$d,this.$L=p.$L,this.init();break}y===x&&(this.$d=new Date(""))}else B.call(this,O)}}})})(it);var xt=it.exports;const Tt=Le(xt);var _t=(l=>(l.BLOCK="block",l.DISPATCH_NEXT_NODE="dispatch_next_node",l.DISPATCH_NEXT_NODE_ON_EXPIRATION="dispatch_next_node_on_expiration",l.FINISH_FLOW="finish_flow",l))(_t||{});const he=class he extends ne{constructor(r,i){super(r,i);d(this,"_expirationDateInMs");d(this,"_nextNodeIdOnExpiration");d(this,"_nextNodeIds");d(this,"_scope");d(this,"_type");this._expirationDateInMs=r.expirationDateInMs,this._nextNodeIdOnExpiration=r.nextNodeIdOnExpiration,this._scope=r.scope,this._type=r.type,this._nextNodeIds=r.nextNodeIds}get expirationDateInMs(){return this._expirationDateInMs??null}get nextNodeIdOnExpiration(){return this._nextNodeIdOnExpiration??null}get nextNodeIds(){return this._nextNodeIds??null}get scope(){return this._scope}get type(){return this._type}static is(r,i){return r.type===i}static isDateBlocker(r){return he.is(r,"date")}static isUserInputBlocker(r){return he.is(r,"user-input")}static isScheduleBlocker(r){return he.is(r,"schedule")}static hasFlowScope(r){return r.scope==="flow"}static hasNodeScope(r){return r.scope==="node"}};d(he,"Result",{block:(r=null)=>({action:"block",blockerId:null,error:r,nextNodeIdOnExpiration:null}),dispatchNextNode:({blockerId:r,data:i})=>({action:"dispatch_next_node",blockerId:r,data:i,error:null,nextNodeIdOnExpiration:null}),dispatchNextNodeOnExpiration:({blockerId:r,error:i=null,nextNodeIdOnExpiration:n})=>({action:"dispatch_next_node_on_expiration",blockerId:r,error:i,nextNodeIdOnExpiration:n}),finishFlow:(r=null)=>({action:"finish_flow",blockerId:null,error:r,nextNodeIdOnExpiration:null})});let le=he;K.extend(It);K.extend(Lt);K.extend(Tt);const ue=class ue extends le{constructor(r,i){super(r,i);d(this,"_props");this._props=r}get days(){return this._props.schedule.days??null}get minTime(){return this._props.schedule.minTime??null}get maxTime(){return this._props.schedule.maxTime??null}static async evaluate(r){try{const{schedule:i}=r;return ue.isInSchedule(i)?le.Result.dispatchNextNode({blockerId:r.id}):le.Result.block()}catch(i){throw console.error(i),i}}static isInSchedule(r){const{days:i,maxTime:n,minTime:t}=r,s=K(),a=s.isoWeekday(),o=K(`${s.format("DD/MM/YYYY")} ${t}:00`,"DD/MM/YYYY HH:mm:ss"),u=K(`${s.format("DD/MM/YYYY")} ${n}:00`,"DD/MM/YYYY HH:mm:ss").add(t>n?1:0,"days");return i.includes(a)?s.isBetween(o,u):le.Result.block()}get metadata(){return{...this._props,id:this.id}}static create(r,i){return ue.validateProps(r),new ue(r,i)}static validateProps(r){if(r.type!=="schedule")throw new Error(`${ue.name}: tipo inválido. Deve ser ${ue.type}`)}};d(ue,"type","schedule");let De=ue;class Ue extends w{constructor(r,i){super(r,i);d(this,"_props");this._props=r}static async action(r,i,n){if(i.enabledSchedule){const t=De.create({schedule:i.schedule,scope:"flow",type:"schedule",nextNodeIds:i.nextNodeIds});n.addBlockerToFlow(r,t.metadata)}}get metadata(){return{...this._props,id:this.id}}static create(r,i){return new Ue(r,i)}}const fe=864e5,at=(l,e,r)=>{const i=[],n=(s,a)=>i.push([s,a]);return{repairedFlowNodes:l.filter(s=>!Object.keys(s).includes("id")||s.id.trim()===""?(n("Item de fluxo inexistente (removido)",r),!1):!w.isAudioNode(s)&&!w.isTextNode(s)&&!w.isContactNode(s)&&!w.isDocumentNode(s)&&!w.isMediaNode(s)&&!w.isDelayNode(s)&&!w.isUserInputNode(s)?(n("Item de fluxo com tipo inválido (removido)",r),!1):!0).map(s=>{if(w.isAudioNode(s)){s.type!=="audio"&&(n("Item de fluxo do tipo áudio com tipo errado",r),s.type="audio"),(!s.flowId||s.flowId.trim()==="")&&(n("Item de fluxo do tipo áudio desassociado de um fluxo",r),s.flowId=e),(!s.itemId||s.itemId.trim()==="")&&n("Item de fluxo do tipo áudio sem item associado",r),s.nextNodeIds!==null&&(!s.nextNodeIds||s.nextNodeIds.length===0)&&(n("Item de fluxo do tipo áudio com próximo item associado errado",r),s.nextNodeIds=null),s.position||(n("Item de fluxo do tipo áudio sem posição",r),s.position={x:0,y:0}),s.simulationDelay!==0&&!s.simulationDelay&&n("Item de fluxo do tipo áudio sem delay",r),s.simulationDelay<0&&n("Item de fluxo do tipo áudio com delay negativo",r),s.simulationDelay>fe&&n("Item de fluxo do tipo áudio com delay maior que o permitido",r);const a=s.simulationDelay?Math.min(Math.max(s.simulationDelay,0),fe):0;return{...s,simulationDelay:a}}if(w.isTextNode(s)){s.type!=="text"&&(n("Item de fluxo do tipo mensagem de texto com tipo errado",r),s.type="text"),(!s.flowId||s.flowId.trim()==="")&&(n("Item de fluxo do tipo mensagem de texto desassociado de um fluxo",r),s.flowId=e),(!s.itemId||s.itemId.trim()==="")&&n("Item de fluxo do tipo mensagem de texto sem item associado",r),s.nextNodeIds!==null&&(!s.nextNodeIds||s.nextNodeIds.length===0)&&(n("Item de fluxo do tipo mensagem de texto com próximo item associado errado",r),s.nextNodeIds=null),s.position||(n("Item de fluxo do tipo mensagem de texto sem posição",r),s.position={x:0,y:0}),s.simulationDelay!==0&&!s.simulationDelay&&n("Item de fluxo do tipo mensagem de texto sem delay",r),s.simulationDelay<0&&n("Item de fluxo do tipo mensagem de texto com delay negativo",r),s.simulationDelay>fe&&n("Item de fluxo do tipo mensagem de texto com delay maior que o permitido",r);const a=s.simulationDelay?Math.min(Math.max(s.simulationDelay,0),fe):0;return{...s,simulationDelay:a}}if(w.isContactNode(s))return s.type!=="contact"&&(n("Item de fluxo do tipo contato com tipo errado",r),s.type="contact"),(!s.flowId||s.flowId.trim()==="")&&(n("Item de fluxo do tipo contato desassociado de um fluxo",r),s.flowId=e),s.nextNodeIds!==null&&(!s.nextNodeIds||s.nextNodeIds.length===0)&&(n("Item de fluxo do tipo contato com próximo item associado errado",r),s.nextNodeIds=null),s.position||(n("Item de fluxo do tipo contato sem posição",r),s.position={x:0,y:0}),(!s.contactName||s.contactName.trim()==="")&&n("Item de fluxo do tipo contato sem nome de contato",r),(!s.contactPhone||s.contactPhone.trim()==="")&&n("Item de fluxo do tipo contato sem número de telefone",r),{...s};if(w.isDocumentNode(s))return s.type!=="document"&&(n("Item de fluxo do tipo documento com tipo errado",r),s.type="document"),(!s.flowId||s.flowId.trim()==="")&&(n("Item de fluxo do tipo documento desassociado de um fluxo",r),s.flowId=e),s.nextNodeIds!==null&&(!s.nextNodeIds||s.nextNodeIds.length===0)&&(n("Item de fluxo do tipo documento com próximo item associado errado",r),s.nextNodeIds=null),s.position||(n("Item de fluxo do tipo documento sem posição",r),s.position={x:0,y:0}),{...s};if(w.isMediaNode(s))return s.type!=="media"&&(n("Item de fluxo do tipo mídia com tipo errado",r),s.type="media"),(!s.flowId||s.flowId.trim()==="")&&(n("Item de fluxo do tipo mídia desassociado de um fluxo",r),s.flowId=e),s.nextNodeIds!==null&&(!s.nextNodeIds||s.nextNodeIds.length===0)&&(n("Item de fluxo do tipo mídia com próximo item associado errado",r),s.nextNodeIds=null),s.position||(n("Item de fluxo do tipo mídia sem posição",r),s.position={x:0,y:0}),{...s};if(w.isDelayNode(s)){s.type!=="delay"&&(n("Item de fluxo do tipo delay com tipo errado",r),s.type="delay"),(!s.flowId||s.flowId.trim()==="")&&(n("Item de fluxo do tipo delay desassociado de um fluxo",r),s.flowId=e),s.nextNodeIds!==null&&(!s.nextNodeIds||s.nextNodeIds.length===0)&&(n("Item de fluxo do tipo delay com próximo item associado errado",r),s.nextNodeIds=null),s.position||(n("Item de fluxo do tipo delay sem posição",r),s.position={x:0,y:0});const a=["seconds","minutes","hours","days"];(!s.timeUnitType||!a.includes(s.timeUnitType))&&(n("Item de fluxo do tipo delay com unidade de delay incorreta",r),s.timeUnitType="seconds"),s.delayInMs!==0&&!s.delayInMs&&n("Item de fluxo do tipo delay sem delay",r),s.delayInMs<1&&n("Item de fluxo do tipo delay com delay negativo",r),s.delayInMs>Number.MAX_SAFE_INTEGER&&n("Item de fluxo do tipo delay com delay maior que o suportado",r);const o=s.delayInMs?Math.min(Math.max(s.delayInMs,1),Number.MAX_SAFE_INTEGER):1;return{...s,delayInMs:o}}if(w.isUserInputNode(s)){s.type!=="user-input"&&(n("Item de fluxo do tipo resposta do usuário com tipo errado",r),s.type="user-input"),(!s.flowId||s.flowId.trim()==="")&&(n("Item de fluxo do tipo resposta do usuário desassociado de um fluxo",r),s.flowId=e),s.nextNodeIds!==null&&(!s.nextNodeIds||s.nextNodeIds.length===0)&&(n("Item de fluxo do tipo resposta do usuário com próximo item associado errado",r),s.nextNodeIds=null),s.position||(n("Item de fluxo do tipo resposta do usuário sem posição",r),s.position={x:0,y:0});const a=["anyTextMessage","anything","contains","equals","startsWith"];(!s.compareRule||!a.includes(s.compareRule))&&(n("Item de fluxo do tipo resposta do usuário com regra incorreta",r),s.compareRule="anything"),a.includes(s.compareRule)&&s.compareRule!=="anyTextMessage"&&s.compareRule!=="anything"&&s.expectedMessages.length===0&&(n("Item de fluxo do tipo resposta do usuário com mensagem esperada incorreta",r),s.compareRule="anything",s.expectedMessages=[]);const o=["seconds","minutes","hours","days"];return(!s.timeUnitType||!o.includes(s.timeUnitType))&&(n("Item de fluxo do tipo resposta do usuário com unidade de resposta do usuário incorreta",r),s.timeUnitType="seconds"),{...s}}throw new Error(`Item de fluxo com formato inválido: ${s.type}`)}),warns:i}},Ve=(l,e,r)=>{let i=0;const n=[],t=(m,v)=>n.push([m,v]),s=Object.keys(l),a=l.enabled??!1,o=l.nodes??[],u=l.updatedAt??new Date;let h=l.name;if(!s.includes("name")||h.trim()===""){i++;const m=`Fluxo (${r}) (corrigido) ${i}`;t(`Dados de fluxo (${r}) sem nome`,m),h=m}s.includes("updatedAt")||t(`Dados de fluxo (${r}) sem opção definida (Data de atualização)`,h),s.includes("enabled")||t(`Dados de fluxo (${r}) sem opção definida (Habilitado)`,h),(!s.includes("nodes")||!l.nodes)&&t(`Dados de fluxo (${r}) sem nós (vazio)`,h);const{repairedFlowNodes:g,warns:f}=at(o,e,h);for(const m of f)t(...m);return{repairedFlowData:{enabled:a,name:h,nodes:g,updatedAt:u},warns:n}},ye=(l,e,r)=>{if(!l)return{repairedFlowStartNode:e,warns:[]};const i=[],n=(s,a)=>i.push([s,a]),t=l;return typeof t.enabledSchedule!="boolean"&&!t.enabledSchedule&&(n("Nó inicial do fluxo sem opção definida (Agendamento habilitado)",r),t.enabledSchedule=e.enabledSchedule),typeof t.enabledTrigger!="boolean"&&!t.enabledTrigger&&(n("Nó inicial do fluxo sem opção definida (Gatilho habilitado)",r),t.enabledTrigger=e.enabledTrigger),(!t.flowId||t.flowId.trim()==="")&&(n("Nó inicial do fluxo sem opção definida (Id do fluxo)",r),t.flowId=e.flowId),t.nextNodeIds!==null&&(!t.nextNodeIds||t.nextNodeIds.length===0)&&(n("Nó inicial do fluxo sem opção definida (Id do próximo nó)",r),t.nextNodeIds=e.nextNodeIds),(!t.position||!t.position.x||!t.position.y)&&(n("Nó inicial do fluxo sem opção definida (Posição)",r),t.position=e.position),(!t.type||t.type!=="start")&&(n("Nó inicial do fluxo com opção incorreta (Tipo)",r),t.type=e.type),t.schedule||(n("Nó inicial do fluxo sem opção definida (Agendamento)",r),t.schedule=e.schedule),t.schedule&&(!t.schedule.days||!Array.isArray(t.schedule.days))&&(n("Nó inicial do fluxo com opção incorreta (Dias do agendamento)",r),t.schedule.days=e.schedule.days),t.schedule&&(!t.schedule.maxTime||typeof t.schedule.maxTime!="string")&&(n("Nó inicial do fluxo com opção incorreta (Hora máxima do agendamento)",r),t.schedule.maxTime=e.schedule.maxTime),t.schedule&&(!t.schedule.minTime||typeof t.schedule.minTime!="string")&&(n("Nó inicial do fluxo com opção incorreta (Hora máxima do agendamento)",r),t.schedule.minTime=e.schedule.minTime),t.trigger||(n("Nó inicial do fluxo sem opção definida (Gatilho)",r),t.trigger=e.trigger),t.trigger&&typeof t.trigger.isCaseSensitive!="boolean"&&!t.trigger.isCaseSensitive&&(n("Nó inicial do fluxo com opção incorreta (Ignorar caixa do gatilho)",r),t.trigger.isCaseSensitive=e.trigger.isCaseSensitive),t.trigger&&typeof t.trigger.sendToContacts!="boolean"&&!t.trigger.sendToContacts&&(n("Nó inicial do fluxo com opção incorreta (Enviar para contatos do gatilho)",r),t.trigger.sendToContacts=e.trigger.sendToContacts),t.trigger&&typeof t.trigger.sendToGroups!="boolean"&&!t.trigger.sendToGroups&&(n("Nó inicial do fluxo com opção incorreta (Enviar para grupos do gatilho)",r),t.trigger.sendToGroups=e.trigger.sendToGroups),t.trigger&&(!t.trigger.keywordRules||!Array.isArray(t.trigger.keywordRules))&&(n("Nó inicial do fluxo com opção incorreta (Regras do gatilho)",r),t.trigger.keywordRules=e.trigger.keywordRules),"nextNodeId"in t&&(t.nextNodeIds=[t.nextNodeId],delete t.nextNodeId),{repairedFlowStartNode:t,warns:i}},Ge=l=>Ue.create({flowId:l,schedule:{days:[],maxTime:"00:00",minTime:"00:00"},enabledSchedule:!1,enabledTrigger:!1,trigger:{isCaseSensitive:!1,keywordRules:[],sendToContacts:!0,sendToGroups:!1},nextNodeIds:null,position:{x:250,y:250},type:"start"},new X).metadata,vt=(l,e)=>({enabled:!0,name:l,nodes:[],updatedAt:e});function Mt({partialFlows:l}){let e=0;const r={},i=(t,s)=>{var o;r[s]||(r[s]=[]);const a=r[s].findIndex(u=>u.startsWith(t));if(a===-1)r[s]=[...r[s],t];else{const u=(o=r[s][a].split(" ").at(-1))==null?void 0:o.split("x")[1],h=Number.isNaN(Number(u))?1:Number(u);r[s].splice(a,1,`${t} x${h+1}`)}};return{flows:l.filter((t,s)=>{var a,o;return!t.id||t.id.trim()===""?(i("Fluxo inexistente (removido)",((a=t.draft)==null?void 0:a.name)??((o=t.published)==null?void 0:o.name)??`Fluxo ${s+1}`),!1):!0}).map(t=>{const s=t.draft.nodes.map(o=>{if(o.type==="user-input"&&"expectedMessage"in o){const u=o.expectedMessage;o.expectedMessages=u?[u]:null,delete o.expectedMessage}return"nextNodeId"in o&&(o.nextNodeIds=o.nextNodeId?[o.nextNodeId]:null,delete o.nextNodeId),o}),a=t.published.nodes.map(o=>{if(o.type==="user-input"&&"expectedMessage"in o){const u=o.expectedMessage;o.expectedMessages=u?[u]:null,delete o.expectedMessage}return"nextNodeId"in o&&(o.nextNodeIds=o.nextNodeId?[o.nextNodeId]:null,delete o.nextNodeId),o});return t.draft.nodes=s,t.published.nodes=a,t}).map(t=>{const s=Object.keys(t),a=t.createdAt??new Date,o=t.updatedAt??new Date;let u=t.draft,h=t.draftStartNode,g=t.published,f=t.publishedStartNode;const m=Ge(t.id),v=new Date,I=("name"in t&&typeof t.name=="string"?t.name:"published"in t&&typeof t.published=="object"&&t.published!==null&&"name"in t.published&&typeof t.published.name=="string"?t.published.name:"draft"in t&&typeof t.draft=="object"&&t.draft!==null&&"name"in t.draft&&typeof t.draft.name=="string"?t.draft.name:null)??`Fluxo (corrigido) ${e}`;if(!s.includes("draftStartNode")&&!s.includes("publishedStartNode")){const M={...Ge(t.id),updatedAt:v},D="startNode"in t&&w.isStartNode(t.startNode)?t.startNode:"draft"in t&&typeof t.draft=="object"&&t.draft!==null&&"startNode"in t.draft&&w.isStartNode(t.draft.startNode)?t.draft.startNode:null,{repairedFlowStartNode:B,warns:O}=ye(D,m,I);for(const F of O)i(...F);const V={...M,...B},W="startNode"in t&&w.isStartNode(t.startNode)?t.startNode:"published"in t&&typeof t.published=="object"&&t.published!==null&&"startNode"in t.published&&w.isStartNode(t.published.startNode)?t.published.startNode:null,{repairedFlowStartNode:$,warns:R}=ye(W,m,I);for(const F of R)i(...F);const N={...M,...$};i("Fluxo sem nó inicial em rascunho e sem nó inicial publicados",I),h=V,f=N}if(!s.includes("draft")&&!s.includes("published")){e++;const M="enabled"in t&&typeof t.enabled=="boolean"?t.enabled??!1:null,D="nodes"in t&&Array.isArray(t.nodes)?t.nodes??[]:null,B="updatedAt"in t?t.updatedAt??new Date:null,O=vt(I,v),{repairedFlowNodes:V,warns:W}=at(D??[],t.id,I);for(const R of W)i(...R);const $={enabled:M??O.enabled,name:I,nodes:D?V:O.nodes,updatedAt:B??O.updatedAt};i("Fluxo sem rascunho e sem dados publicados",I),u=$,g=$}if(s.includes("draft")){const{repairedFlowData:M,warns:D}=Ve(t.draft,t.id,"Rascunho");u=M;for(const B of D)i(...B)}if(s.includes("draftStartNode")){const{repairedFlowStartNode:M,warns:D}=ye(t.draftStartNode,m,t.draft.name);h={...M,updatedAt:t.draftStartNode.updatedAt??t.publishedStartNode.updatedAt??t.updatedAt};for(const B of D)i(...B)}if(s.includes("published")){const{repairedFlowData:M,warns:D}=Ve(t.published,t.id,"Publicado");g=M;for(const B of D)i(...B)}if(s.includes("publishedStartNode")){const{repairedFlowStartNode:M,warns:D}=ye(t.publishedStartNode,m,t.published.name);h={...M,updatedAt:t.publishedStartNode.updatedAt??t.draftStartNode.updatedAt??t.updatedAt};for(const B of D)i(...B)}s.includes("draft")&&!s.includes("published")&&(g=u),!s.includes("draft")&&s.includes("published")&&(u=g),s.includes("draftStartNode")&&!s.includes("publishedStartNode")&&(f=h),s.includes("publishedStartNode")&&!s.includes("draftStartNode")&&(h=f),s.includes("createdAt")||i("Fluxo sem opção definida (Data de criação)",g.name),s.includes("updatedAt")||i("Fluxo sem opção definida (Data de atualização)",g.name);const U="isFavorite"in t&&typeof t.isFavorite=="boolean"?t.isFavorite??!1:!1;return s.includes("isFavorite")||i("Fluxo sem opção definida (Favorito)",g.name),{createdAt:a,draft:u,draftStartNode:h,id:t.id,isFavorite:U,published:g,publishedStartNode:f,updatedAt:o}}),flowWarns:r}}const Dt=l=>{const e=l.map(r=>"metadata"in r?r.type:null).filter(r=>r);if(e.length>0){const i=`You can only include node metadata in nodes
Wrong node types:
${e.join(`
`)}
`;throw new Error(i)}};class Ee extends ne{get createdAt(){return this.props.createdAt}get draft(){return this.props.draft}get draftStartNode(){return this.props.draftStartNode}get isFavorite(){return this.props.isFavorite}get publishedStartNode(){return this.props.publishedStartNode}get published(){return this.props.published}get updatedAt(){return this.props.updatedAt}get metadata(){return{...this.props,id:this.id}}static create(e,r){const i=new Date;return Dt(e.published.nodes),new Ee({...e,createdAt:e.createdAt??i,updatedAt:e.updatedAt??i},r)}}const Ft={dummyTrigger:!1,selectedFlowId:"",flowList:[]},Se="ZV:flowStore";class vs{constructor(e,r={shouldCheckAndRepair:!1}){d(this,"_store");d(this,"useGetHasFlows",()=>L(this.store,e=>e.flowList.length>0));d(this,"useGetFlowCount",()=>L(this.store,e=>e.flowList.length));d(this,"getIsDraftSelectedFlow",()=>c.unstable_batchedUpdates(()=>{const e=this.flowList,r=this.selectedFlowId;return e.some(i=>i.id===r&&(i.draft.updatedAt!==i.published.updatedAt||i.draftStartNode.updatedAt!==i.publishedStartNode.updatedAt))}));d(this,"useGetIsDraftFlow",e=>L(this.store,r=>r.flowList.some(i=>i.id===e&&(i.draft.updatedAt!==i.published.updatedAt||i.draftStartNode.updatedAt!==i.publishedStartNode.updatedAt))));d(this,"useGetFlowList",()=>L(this.store,e=>e.flowList));d(this,"addFlow",(...e)=>c.unstable_batchedUpdates(()=>this.store.getState().addFlow(...e)));d(this,"addNodeToFlow",(...e)=>c.unstable_batchedUpdates(()=>this.store.getState().addNodeToFlow(...e)));d(this,"deleteFlow",(...e)=>c.unstable_batchedUpdates(()=>this.store.getState().deleteFlow(...e)));d(this,"findAll",(...e)=>c.unstable_batchedUpdates(()=>this.store.getState().findAll(...e)));d(this,"findById",(...e)=>c.unstable_batchedUpdates(()=>this.store.getState().findById(...e)));d(this,"findFlowsWithItem",(...e)=>c.unstable_batchedUpdates(()=>this.store.getState().findFlowsWithItem(...e)));d(this,"removeNodeFromFlow",(...e)=>c.unstable_batchedUpdates(()=>this.store.getState().removeNodeFromFlow(...e)));d(this,"selectFlow",(...e)=>c.unstable_batchedUpdates(()=>this.store.getState().selectFlow(...e)));d(this,"updateFlow",(...e)=>c.unstable_batchedUpdates(()=>this.store.getState().updateFlow(...e)));d(this,"updateManyNodes",(...e)=>c.unstable_batchedUpdates(()=>this.store.getState().updateManyNodes(...e)));d(this,"updateNode",(...e)=>c.unstable_batchedUpdates(()=>this.store.getState().updateNode(...e)));d(this,"updateStartNode",(...e)=>c.unstable_batchedUpdates(()=>this.store.getState().updateStartNode(...e)));this.zustandStorage=e,this.options=r,this._store=J()(Q((i,n)=>({...Ft,lastCheckedAt:null,toggleDummy:()=>i(t=>({dummyTrigger:!t.dummyTrigger})),addFlow:async t=>{const s=new Date;i(a=>({flowList:[...a.flowList,{createdAt:t.createdAt??new Date,draft:{...t.draft,updatedAt:t.draft.updatedAt??s},draftStartNode:{...t.draftStartNode,updatedAt:t.draftStartNode.updatedAt??s},id:t.id,isFavorite:t.isFavorite,published:{...t.published,updatedAt:t.published.updatedAt??s},publishedStartNode:{...t.publishedStartNode,updatedAt:t.publishedStartNode.updatedAt??s},updatedAt:t.updatedAt??new Date}]}))},selectFlow:async t=>i({selectedFlowId:t}),addNodeToFlow:async({flowId:t,node:s})=>{const o=n().flowList.find(u=>u.id===t);if(o){const u=o.draft.nodes.concat(s),h={...o,draft:{...o.draft,updatedAt:new Date,nodes:u}};i(g=>({flowList:g.flowList.map(f=>f.id!==h.id?f:h)}))}},deleteFlow:async t=>{i(s=>({flowList:s.flowList.filter(a=>a.id!==t)}))},findAll:async()=>n().flowList,findById:async t=>{const s=n().flowList.find(a=>a.id===t);return s?Ee.create({createdAt:s.createdAt,draft:s.draft,draftStartNode:s.draftStartNode,isFavorite:s.isFavorite,published:s.published,publishedStartNode:s.publishedStartNode,updatedAt:s.updatedAt},new X(t)).metadata:null},findFlowsWithItem:async t=>n().flowList.filter(s=>s.draft.nodes.some(a=>"itemId"in a&&a.itemId===t)).map(s=>s.draft.name),removeNodeFromFlow:async(t,s)=>{const a=n().flowList.find(o=>o.id===t);if(a){const o=[],u={...a,draft:{...a.draft,nodes:a.draft.nodes.filter(h=>{var m;const g=(m=h.nextNodeIds)==null?void 0:m.includes(s),f=h.nextNodeIdOnExpiration===s;return(g||f)&&(o.includes(h.id)||o.push(h.id)),h.id!==s}).map(h=>{var g;if(o.includes(h.id)){const f=(g=h.nextNodeIds)==null?void 0:g.findIndex(v=>v===s),m=h.nextNodeIds;return f!==void 0&&f!==-1&&(m==null||m.splice(f,1)),{...h,nextNodeIds:(m==null?void 0:m.length)===0?null:h.nextNodeIds,nextNodeIdOnExpiration:h.nextNodeIdOnExpiration===s?null:h.nextNodeIdOnExpiration}}return h})}};i(h=>({flowList:h.flowList.map(g=>g.id!==u.id?g:u)}))}},updateFlow:async t=>{i(s=>({flowList:s.flowList.map(a=>a.id!==t.id?a:{...t,updatedAt:t.updatedAt??new Date})}))},updateManyNodes:async({flowId:t,data:s})=>{const a=n().flowList.find(o=>o.id===t);if(a){const o=a.draft.nodes.map(m=>{const v=s.find(k=>k.id===m.id);return v?{...m,...v.props}:m}),u=s.find(m=>m.id===a.draftStartNode.id),h=new Date,g=u?{...a.draftStartNode,...u.props,updatedAt:h}:a.draftStartNode,f={...a,draft:{...a.draft,nodes:o,updatedAt:h},draftStartNode:g};i(m=>({flowList:m.flowList.map(v=>v.id!==t?v:f)}))}},updateNode:async({flowId:t,data:s})=>{const o=n().flowList.find(u=>u.id===t);if(o){const u=o.draft.nodes.find(h=>h.id===s.id);if(u){const h={...u,...s.props},g={...o,draft:{...o.draft,nodes:o.draft.nodes.map(f=>f.id!==s.id?f:h),updatedAt:new Date}};i(f=>({flowList:f.flowList.map(m=>m.id!==g.id?m:g)}))}}},updateStartNode:async({flowId:t,data:s})=>{const o=n().flowList.find(u=>u.id===t);if(o&&o.draftStartNode.id===s.id){const h={...o.draftStartNode,...s.props},g={...o,draftStartNode:{...h,updatedAt:new Date}};i(f=>({flowList:f.flowList.map(m=>m.id!==g.id?m:g)}))}}}),{name:Se,storage:ee(()=>this.zustandStorage),version:0})),this.options.shouldCheckAndRepair&&this.checkAndRepairFlowStore(),this.zustandStorage.addStorageListener(async()=>{await this.rehydrateStore()},[Se])}async rehydrateStore(){setTimeout(async()=>{await this._store.persist.rehydrate()},300)}async checkAndRepairFlowStore(){const e=await this.zustandStorage.getParsedItem(Se);if(!e)return;const r=e.state.lastCheckedAt,i=e.state.flowList;if(i.length<=0||r&&r>=new Date)return;const{flows:n}=Mt({partialFlows:i});if(n.length>0){const t=structuredClone(e);t.state.flowList=n,t.state.lastCheckedAt=new Date,await this.zustandStorage.setItem(Se,JSON.stringify(t))}}get store(){return this._store}get flowList(){return c.unstable_batchedUpdates(()=>this.store.getState().flowList)}get selectedFlowId(){return c.unstable_batchedUpdates(()=>this.store.getState().selectedFlowId)}get hasFlows(){return c.unstable_batchedUpdates(()=>this.store.getState().flowList.length>0)}}class xe extends ne{get funnelId(){return this.props.funnelId}get id(){return this.props.id}get itemId(){return this.props.itemId}get delayBeforeSend(){return this.props.delayBeforeSend}get type(){return this.props.type}get metadata(){return{delayBeforeSend:this.delayBeforeSend,funnelId:this.funnelId,id:this.id,itemId:this.itemId,type:this.type}}}class we extends xe{static create(e,r){return new we({...e,type:"audio"},r)}}class ke extends xe{static create(e,r){return new ke({...e,type:"document"},r)}}class Ne extends xe{static create(e,r){return new Ne({...e,type:"media"},r)}}class Ce extends xe{static create(e,r){return new Ce({...e,type:"message"},r)}}const At={dummyTrigger:!1,filterTerm:"",funnelList:[],selectedFunnelId:""},Ut="funis",Ye="ZV:funnelStore";class Ms{constructor(e,r={shouldMigrate:!1}){d(this,"_store");d(this,"useGetFunnelList",()=>L(this.store,e=>e.funnelList));d(this,"useDashboardFunnelList",()=>L(this.store,e=>{const r=e.filterTerm,i=r.trim().length>0?e.funnelList.filter(t=>A(t.name,{toLowerCase:!0}).includes(A(e.filterTerm,{toLowerCase:!0}))):e.funnelList,n=e.selectedFunnelId;return{filteredFunnelList:i,filterTerm:r,selectedFunnelId:n}}));d(this,"useGetFunnelCount",()=>L(this.store,e=>e.funnelList.length));d(this,"useGetFilteredFunnelList",()=>L(this.store,e=>e.funnelList.filter(r=>A(r.name,{toLowerCase:!0}).includes(A(e.filterTerm,{toLowerCase:!0})))));d(this,"useGetHasFunnels",()=>L(this.store,e=>e.funnelList.length>0));d(this,"useGetFilterTerm",()=>L(this.store,e=>e.filterTerm));d(this,"useGetSelectedFunnel",()=>L(this.store,e=>({selectedFunnelId:e.selectedFunnelId,dummyTrigger:e.dummyTrigger})));this.zustandStorage=e,this.options=r,this._store=J()(Q((i,n)=>({...At,toggleDummy:()=>i(t=>({dummyTrigger:!t.dummyTrigger})),addFunnel:async t=>{i(s=>({funnelList:[...s.funnelList,{id:t.id,isFavorite:!!t.isFavorite,name:t.name,itemsSequence:t.itemsSequence}],filterTerm:"",selectedFunnelId:t.id}))},deleteFunnel:async t=>{i(s=>({funnelList:s.funnelList.filter(a=>a.id!==t),selectedFunnelId:"",filterTerm:""}))},findById:async t=>n().funnelList.find(s=>s.id===t)??null,findFunnelsWithItem:async t=>n().funnelList.filter(s=>s.itemsSequence.some(a=>a.itemId===t)).map(s=>s.name),getSequenceItems:async(t,s)=>{const a=await n().findById(t);return a?a.itemsSequence.slice(s,a.itemsSequence.length):[]},reorderFunnelList:async t=>{const{sourceIndex:s,destinationIndex:a}=t,o=n().funnelList,u=o.splice(s,1);o.splice(a,0,...u),i({funnelList:o})},saveFunnel:async t=>{i(a=>({funnelList:a.funnelList.map(o=>{var u;if(o.id===t.id){const h=((u=t.name)==null?void 0:u.trim())??"";return{id:t.id,isFavorite:t.isFavorite??o.isFavorite,name:h===""?o.name:h,itemsSequence:t.itemsSequence??o.itemsSequence}}return o})}));const s=n().selectedFunnelId;s&&t.id===s&&n().toggleDummy()},selectFunnel:async t=>i({selectedFunnelId:t}),setFunnelFilter:async t=>{i({filterTerm:t.trim()})},getAll:()=>this._store.getState().funnelList}),{name:Ye,storage:ee(()=>e),version:0})),this.options.shouldMigrate&&this.validateFunnelMigration(),e.addStorageListener(async()=>{await this.rehydrateStore()},[Ye])}async rehydrateStore(){setTimeout(async()=>{await this._store.persist.rehydrate()},300)}get store(){return this._store}get funnelList(){return c.unstable_batchedUpdates(()=>this.store.getState().funnelList)}get funnelCount(){return c.unstable_batchedUpdates(()=>this.store.getState().funnelList.length)}get filterTerm(){return c.unstable_batchedUpdates(()=>this.store.getState().filterTerm)}get filteredFunnelList(){return c.unstable_batchedUpdates(()=>{const e=this.store.getState().filterTerm,r=this.store.getState().funnelList;return e?r.filter(i=>A(i.name,{toLowerCase:!0}).includes(A(e,{toLowerCase:!0}))):r})}get hasFunnels(){return c.unstable_batchedUpdates(()=>this.store.getState().funnelList.length>0)}get selectedFunnel(){return c.unstable_batchedUpdates(()=>this.store.getState().selectedFunnelId)}addFunnel(...e){return c.unstable_batchedUpdates(()=>this.store.getState().addFunnel(...e))}deleteFunnel(...e){return c.unstable_batchedUpdates(()=>this.store.getState().deleteFunnel(...e))}findById(...e){return c.unstable_batchedUpdates(()=>this.store.getState().findById(...e))}findFunnelsWithItem(...e){return c.unstable_batchedUpdates(()=>this.store.getState().findFunnelsWithItem(...e))}getSequenceItems(...e){return c.unstable_batchedUpdates(()=>this.store.getState().getSequenceItems(...e))}reorderFunnelList(...e){return c.unstable_batchedUpdates(()=>this.store.getState().reorderFunnelList(...e))}saveFunnel(...e){return c.unstable_batchedUpdates(async()=>this.store.getState().saveFunnel(...e))}selectFunnel(...e){return c.unstable_batchedUpdates(()=>this.store.getState().selectFunnel(...e))}setFunnelFilter(...e){return c.unstable_batchedUpdates(()=>this.store.getState().setFunnelFilter(...e))}migrateOldFunnelItem(e,r){switch(r.type){case"medias":return Ne.create({id:new X().toString(),itemId:r.id,funnelId:e,delayBeforeSend:r.delay}).metadata;case"audios":return we.create({id:new X().toString(),itemId:r.id,funnelId:e,delayBeforeSend:r.delay}).metadata;case"docs":return ke.create({id:new X().toString(),itemId:r.id,funnelId:e,delayBeforeSend:r.delay}).metadata;case"mensagens":return Ce.create({id:new X().toString(),itemId:r.id,funnelId:e,delayBeforeSend:r.delay}).metadata}}async migrateFromOldSchema(e){this.store.setState({funnelList:e.map(r=>{var i;return{id:r.id,name:r.name,itemsSequence:((i=r.data)==null?void 0:i.map(n=>this.migrateOldFunnelItem(r.id,n)))??[],isFavorite:!1}})})}async validateFunnelMigration(e=!1){const r="migratedFunnelSchema",i=await this.zustandStorage.getParsedItem(r);if(i)return;const n=this.store.getState().funnelList;if(n.length>0&&e===!1)return;const s=await this.zustandStorage.getParsedItem(Ut);(!!(n.length===0&&s&&s.length>0)&&!i||e)&&(await this.zustandStorage.setItem(r,"true"),await this.migrateFromOldSchema(s??[])),e&&(e=!1)}}class Be extends ne{get caption(){return this.props.caption}set caption(e){this.props.caption=e}set isPtv(e){this.props.isPtv=e}get isPtv(){return this.props.isPtv??!1}get data(){return this.props.data}set data(e){this.props.data=e}get isFavorite(){return this.props.isFavorite}set isFavorite(e){this.props.isFavorite=e}get name(){return this.props.name}set name(e){this.props.name=e}get asViewOnce(){return this.props.asViewOnce}set asViewOnce(e){this.props.asViewOnce=e}get metadata(){return{caption:this.props.caption,data:this.props.data,id:this.id,isFavorite:this.props.isFavorite,name:this.props.name}}static create(e,r){return new Be(e,r)}}const Et={dummyTrigger:!1,filterTerm:"",mediaList:[],selectedMediaId:""},He="ZV:mediaStore";class Ds{constructor(e,r={shouldMigrate:!1}){d(this,"_store");d(this,"useDashboardMediaList",()=>L(this.store,e=>{const r=e.filterTerm,i=r.trim().length>0?e.mediaList.filter(t=>A(t.name,{toLowerCase:!0}).includes(A(r,{toLowerCase:!0}))):e.mediaList,n=e.selectedMediaId;return{filteredMediaList:i,filterTerm:r,selectedMediaId:n}}));d(this,"useGetMediaList",()=>L(this.store,e=>e.mediaList));d(this,"useGetMediaCount",()=>L(this.store,e=>e.mediaList.length));d(this,"useGetFilteredMediaList",()=>L(this.store,e=>e.mediaList.filter(r=>A(r.name,{toLowerCase:!0}).includes(A(e.filterTerm,{toLowerCase:!0})))));d(this,"useGetHasMedias",()=>L(this.store,e=>e.mediaList.length>0));d(this,"useGetFilterTerm",()=>L(this.store,e=>e.filterTerm));d(this,"useGetSelectedMedia",()=>L(this.store,e=>({selectedMediaId:e.selectedMediaId,dummyTrigger:e.dummyTrigger})));d(this,"addMedia",(...e)=>c.unstable_batchedUpdates(()=>this.store.getState().addMedia(...e)));d(this,"deleteMedia",(...e)=>c.unstable_batchedUpdates(()=>this.store.getState().deleteMedia(...e)));d(this,"findById",(...e)=>c.unstable_batchedUpdates(()=>this.store.getState().findById(...e)));d(this,"getMediaDataById",(...e)=>c.unstable_batchedUpdates(()=>this.store.getState().getMediaDataById(...e)));d(this,"reorderMediaList",(...e)=>c.unstable_batchedUpdates(()=>this.store.getState().reorderMediaList(...e)));d(this,"saveMedia",(...e)=>c.unstable_batchedUpdates(async()=>this.store.getState().saveMedia(...e)));d(this,"selectMedia",(...e)=>c.unstable_batchedUpdates(()=>this.store.getState().selectMedia(...e)));d(this,"setMediaFilter",(...e)=>c.unstable_batchedUpdates(()=>this.store.getState().setMediaFilter(...e)));d(this,"toggleMediaIsFavorite",(...e)=>c.unstable_batchedUpdates(async()=>this.store.getState().toggleMediaIsFavorite(...e)));this.zustandStorage=e,this.options=r,this._store=J()(Q((i,n)=>({...Et,toggleDummy:()=>i(t=>({dummyTrigger:!t.dummyTrigger})),addMedia:async t=>{await this.zustandStorage.setItem(t.id,{caption:t.caption,data:t.data}),i(s=>({mediaList:[...s.mediaList,{id:t.id.toString(),isFavorite:!!t.isFavorite,name:t.name,asViewOnce:!!t.asViewOnce,isPtv:!!t.isPtv}],filterTerm:"",selectedMediaId:t.id}))},deleteMedia:async t=>{i(s=>({mediaList:s.mediaList.filter(a=>a.id!==t),selectedMediaId:"",filterTerm:""})),await this.zustandStorage.removeItem(t)},findById:async t=>{const s=await this.getMediaDataById(t),a=n().mediaList.find(o=>o.id===t);return s!=null&&s.data&&a?Be.create({caption:s.caption,data:s.data,isFavorite:a.isFavorite,name:a.name,asViewOnce:a.asViewOnce,isPtv:a.isPtv},new X(t)):null},getMediaDataById:async t=>{let s=null;const a=await this.zustandStorage.getParsedItem(t);return a&&(s={caption:a.caption??"",data:a.data??""}),s},reorderMediaList:async t=>{const{sourceIndex:s,destinationIndex:a}=t,o=n().mediaList,u=o.splice(s,1);o.splice(a,0,...u),i({mediaList:o})},saveMedia:async t=>{await this.zustandStorage.setItem(t.id,{caption:t.caption,data:t.data}),i(a=>({mediaList:a.mediaList.map(o=>{var u;if(o.id===t.id){const h=((u=t.name)==null?void 0:u.trim())??"";return{id:t.id,isFavorite:t.isFavorite??o.isFavorite,name:h===""?o.name:h,asViewOnce:t.asViewOnce??o.asViewOnce,isPtv:t.isPtv??o.isPtv}}return o})}));const s=n().selectedMediaId;s&&t.id===s&&n().toggleDummy()},selectMedia:async t=>{i({selectedMediaId:t})},setMediaFilter:async t=>{i({filterTerm:t.trim()})},toggleMediaIsFavorite:async t=>{i(s=>({mediaList:s.mediaList.map(a=>a.id===t?{...a,isFavorite:!a.isFavorite}:a)}))}}),{name:He,storage:ee(()=>e),version:0})),this.options.shouldMigrate&&this.validateMediaMigration(),e.addStorageListener(async()=>{await this.rehydrateStore()},[He])}async rehydrateStore(){setTimeout(async()=>{await this._store.persist.rehydrate()},300);try{JSON.parse(localStorage.getItem("ZV:cachedMediaIds")||"[]").forEach(r=>{localStorage.removeItem(r.id)}),localStorage.removeItem("ZV:cachedMediaIds")}catch{}}get store(){return this._store}get mediaList(){return c.unstable_batchedUpdates(()=>this.store.getState().mediaList)}get mediaCount(){return c.unstable_batchedUpdates(()=>this.store.getState().mediaList.length)}get filteredmediaList(){return c.unstable_batchedUpdates(()=>{const e=this.store.getState().filterTerm;return this.store.getState().mediaList.filter(i=>A(i.name,{toLowerCase:!0}).includes(A(e,{toLowerCase:!0})))})}get hasMedias(){return c.unstable_batchedUpdates(()=>this.store.getState().mediaList.length>0)}get filterTerm(){return c.unstable_batchedUpdates(()=>this.store.getState().filterTerm)}get selectedMedia(){return c.unstable_batchedUpdates(()=>this.store.getState().selectedMediaId)}async migrateFromOldSchema(e){this.store.setState({mediaList:e.map(r=>({id:r.id.toString(),isFavorite:!1,name:r.name,asViewOnce:!1,isPtv:!1}))})}async validateMediaMigration(e=!1){const r="migratedMediaSchema",i=await this.zustandStorage.getParsedItem(r);if(i)return;const n="mediasIndex",t=this._store.getState().mediaList;if(t.length>0&&e===!1)return;const a=await this.zustandStorage.getParsedItem(n);(!!(t.length===0&&a&&a.length>0)&&!i||e)&&(await this.zustandStorage.setItem(r,"true"),await this.migrateFromOldSchema(a??[])),e&&(e=!1)}}class Pe extends ne{get name(){return this.props.name}set name(e){this.props.name=e}get data(){return this.props.data}set data(e){this.props.data=e}get isFavorite(){return this.props.isFavorite}set isFavorite(e){this.props.isFavorite=e}get metadata(){return{id:this.id,name:this.props.name,data:this.props.data,isFavorite:this.props.isFavorite}}static create(e,r){return new Pe(e,r)}}const wt={dummyTrigger:!1,filterTerm:"",selectedTextMessageId:"",textMessageList:[]},We="ZV:textMessageStore",kt="mensagensIndex";class Fs{constructor(e,r={shouldMigrate:!1}){d(this,"_store");d(this,"useDashboardTextMessageList",()=>L(this.store,e=>{const r=e.filterTerm,i=r.trim().length>0?e.textMessageList.filter(t=>A(t.name,{toLowerCase:!0}).includes(A(r,{toLowerCase:!0}))):e.textMessageList,n=e.selectedTextMessageId;return{filteredTextMessageList:i,filterTerm:r,selectedTextMessageId:n}}));d(this,"useGetTextMessageList",()=>L(this.store,e=>e.textMessageList));d(this,"useGetTextMessageCount",()=>L(this.store,e=>e.textMessageList.length));d(this,"useGetFilteredTextMessageList",()=>L(this.store,e=>e.textMessageList.filter(r=>A(r.name,{toLowerCase:!0}).includes(A(e.filterTerm,{toLowerCase:!0})))));d(this,"useGetHasTextMessages",()=>L(this.store,e=>e.textMessageList.length>0));d(this,"useGetFilterTerm",()=>L(this.store,e=>e.filterTerm));d(this,"useGetSelectedTextMessage",()=>L(this.store,e=>({selectedTextMessageId:e.selectedTextMessageId,dummyTrigger:e.dummyTrigger})));d(this,"addTextMessage",e=>c.unstable_batchedUpdates(()=>this.store.getState().addTextMessage(e)));d(this,"deleteTextMessage",e=>c.unstable_batchedUpdates(()=>this.store.getState().deleteTextMessage(e)));d(this,"findById",e=>c.unstable_batchedUpdates(()=>this.store.getState().findById(e)));d(this,"getTextMessageDataById",e=>c.unstable_batchedUpdates(()=>this.store.getState().getTextMessageDataById(e)));d(this,"reorderTextMessageList",e=>c.unstable_batchedUpdates(()=>this.store.getState().reorderTextMessageList(e)));d(this,"saveTextMessage",e=>c.unstable_batchedUpdates(async()=>this.store.getState().saveTextMessage(e)));d(this,"selectTextMessage",e=>c.unstable_batchedUpdates(()=>this.store.getState().selectTextMessage(e)));d(this,"setTextMessageFilter",e=>c.unstable_batchedUpdates(()=>this.store.getState().setTextMessageFilter(e)));d(this,"toggleTextMessageIsFavorite",e=>c.unstable_batchedUpdates(async()=>this.store.getState().toggleTextMessageIsFavorite(e)));this.zustandStorage=e,this.options=r,this._store=J()(Q((i,n)=>({...wt,toggleDummy:()=>i(t=>({dummyTrigger:!t.dummyTrigger})),addTextMessage:async t=>{await this.zustandStorage.setItem(t.id,{data:t.data}),i(s=>({textMessageList:[...s.textMessageList,{id:t.id.toString(),isFavorite:t.isFavorite,name:t.name}],filterTerm:"",selectedTextMessageId:t.id}))},deleteTextMessage:async t=>{i(s=>({textMessageList:s.textMessageList.filter(a=>a.id!==t),selectedTextMessageId:"",filterTerm:""})),await this.zustandStorage.removeItem(t)},findById:async t=>{const s=await this.getTextMessageDataById(t),a=n().textMessageList.find(o=>o.id===t);return a&&(s!=null&&s.data||(s==null?void 0:s.data)==="")?Pe.create({data:s.data,isFavorite:a.isFavorite,name:a.name},new X(t)):null},getTextMessageDataById:async t=>{let s=null;const a=await this.zustandStorage.getParsedItem(t);return typeof(a==null?void 0:a.data)=="string"&&(s={data:a.data}),s},reorderTextMessageList:async t=>{const{sourceIndex:s,destinationIndex:a}=t,o=n().textMessageList,u=o.splice(s,1);o.splice(a,0,...u),i({textMessageList:o})},saveTextMessage:async t=>{await this.zustandStorage.setItem(t.id,{data:t.data}),i(a=>({textMessageList:a.textMessageList.map(o=>{var u;if(o.id===t.id){const h=((u=t.name)==null?void 0:u.trim())??"";return{id:t.id,isFavorite:t.isFavorite??o.isFavorite,name:h===""?o.name:h}}return o})}));const s=n().selectedTextMessageId;s&&t.id===s&&n().toggleDummy()},selectTextMessage:async t=>i({selectedTextMessageId:t}),setTextMessageFilter:async t=>{i({filterTerm:t.trim()})},toggleTextMessageIsFavorite:async t=>{i(s=>({textMessageList:s.textMessageList.map(a=>a.id===t?{...a,isFavorite:!a.isFavorite}:a)}))}}),{name:We,storage:ee(()=>e),version:0})),this.options.shouldMigrate&&this.validateTextMessageMigration(),e.addStorageListener(async()=>{await this.rehydrateStore()},[We])}async rehydrateStore(){setTimeout(async()=>{await this._store.persist.rehydrate()},300);try{JSON.parse(localStorage.getItem("ZV:cachedTextMessageIds")||"[]").forEach(r=>{localStorage.removeItem(r.id)}),localStorage.removeItem("ZV:cachedTextMessageIds")}catch{}}get store(){return this._store}get textMessageList(){return c.unstable_batchedUpdates(()=>this.store.getState().textMessageList)}get textMessageCount(){return c.unstable_batchedUpdates(()=>this.store.getState().textMessageList.length)}get filteredTextMessageList(){return c.unstable_batchedUpdates(()=>{const e=this.store.getState().filterTerm;return this.store.getState().textMessageList.filter(i=>A(i.name,{toLowerCase:!0}).includes(A(e,{toLowerCase:!0})))})}get hasTextMessages(){return c.unstable_batchedUpdates(()=>this.store.getState().textMessageList.length>0)}get filterTerm(){return c.unstable_batchedUpdates(()=>this.store.getState().filterTerm)}get selectedTextMessage(){return c.unstable_batchedUpdates(()=>this.store.getState().selectedTextMessageId)}async migrateFromOldSchema(e){this.store.setState({textMessageList:e.map(r=>({id:r.id,name:r.name,isFavorite:!1}))})}async validateTextMessageMigration(e=!1){const r="migratedMessageSchema",i=await this.zustandStorage.getParsedItem(r);if(i)return;const n=this.store.getState().textMessageList;if(n.length>0&&e===!1)return;const s=await this.zustandStorage.getParsedItem(kt);(!!(n.length===0&&s&&s.length>0)&&!i||e)&&(await this.zustandStorage.setItem(r,"true"),await this.migrateFromOldSchema(s??[])),e&&(e=!1)}}class Oe extends ne{get createdAt(){return this.props.createdAt}get endTimeInMs(){return this.props.endTimeInMs}get funnelData(){return this.props.funnelData}get isBulkItem(){return this.props.isBulkItem}get isPtt(){return this.props.isPtt}get itemId(){return this.props.itemId}get itemName(){return this.props.itemName}get scheduleDate(){return this.props.scheduleDate}get scheduledByUser(){return this.props.scheduledByUser}get sentAt(){return this.props.sentAt}get simulationDelay(){return this.props.simulationDelay}get startTimeInMs(){return this.props.startTimeInMs}get status(){return this.props.status}get targetChatId(){return this.props.targetChatId}get targetChatName(){return this.props.targetChatName}get type(){return this.props.type}get uuidCode(){return this.props.uuidCode}static create(e,r){return new Oe({...e,isPtt:e.isPtt??null},r)}}const Nt={dummyTrigger:!1,scheduleList:[]},Ct="ZV:scheduleStore";class As{constructor(e){d(this,"_store");d(this,"useGetHasSchedules",()=>L(this.store,e=>e.scheduleList.length>0));d(this,"useGetScheduleList",()=>L(this.store,e=>e.scheduleList));d(this,"addSchedule",(...e)=>c.unstable_batchedUpdates(()=>this.store.getState().addSchedule(...e)));d(this,"changeSchedulesStatus",(...e)=>c.unstable_batchedUpdates(()=>this.store.getState().changeSchedulesStatus(...e)));d(this,"deleteManySchedules",(...e)=>c.unstable_batchedUpdates(()=>this.store.getState().deleteManySchedules(...e)));d(this,"deleteSchedule",(...e)=>c.unstable_batchedUpdates(()=>this.store.getState().deleteSchedule(...e)));d(this,"findById",(...e)=>c.unstable_batchedUpdates(()=>this.store.getState().findById(...e)));d(this,"findManySchedules",()=>c.unstable_batchedUpdates(()=>this.store.getState().findManySchedules()));d(this,"findManyByStatus",(...e)=>c.unstable_batchedUpdates(()=>this.store.getState().findManyByStatus(...e)));d(this,"getScheduledByChatId",(...e)=>c.unstable_batchedUpdates(()=>this.store.getState().getScheduledByChatId(...e)));d(this,"getScheduledFunnelByFunnelId",(...e)=>c.unstable_batchedUpdates(()=>this.store.getState().getScheduledFunnelByFunnelId(...e)));d(this,"markScheduleAsSent",(...e)=>c.unstable_batchedUpdates(()=>this.store.getState().markScheduleAsSent(...e)));d(this,"removeAutoScheduledItems",(...e)=>c.unstable_batchedUpdates(()=>this.store.getState().removeAutoScheduledItems(...e)));d(this,"removeSentScheduledItems",(...e)=>c.unstable_batchedUpdates(()=>this.store.getState().removeSentScheduledItems(...e)));d(this,"removeScheduledItemByChatAndUuidCode",(...e)=>c.unstable_batchedUpdates(()=>this.store.getState().removeScheduledItemByChatAndUuidCode(...e)));this.zustandStorage=e,this._store=J()(Q((r,i)=>({...Nt,toggleDummy:()=>r(n=>({dummyTrigger:!n.dummyTrigger})),addSchedule:async n=>{r(t=>({scheduleList:[...t.scheduleList,{createdAt:n.createdAt,endTimeInMs:n.endTimeInMs,funnelData:n.funnelData,id:n.id,isBulkItem:n.isBulkItem,isPtt:n.isPtt,itemId:n.itemId,itemName:n.itemName,scheduleDate:n.scheduleDate,scheduledByUser:n.scheduledByUser,sentAt:n.sentAt,simulationDelay:n.simulationDelay,startTimeInMs:n.startTimeInMs,status:n.status,targetChatId:n.targetChatId,targetChatName:n.targetChatName,type:n.type,uuidCode:n.uuidCode}]}))},changeSchedulesStatus:async n=>{r(t=>({scheduleList:t.scheduleList.map(s=>{var o;const a=(o=n.find(u=>u.scheduleId===s.id))==null?void 0:o.status;return a?{...s,status:a??s.status,sentAt:a==="sent"?new Date:null}:s})}))},deleteManySchedules:async n=>{r(t=>({scheduleList:t.scheduleList.filter(s=>!n.includes(s.id))}))},deleteSchedule:async n=>{r(t=>({scheduleList:t.scheduleList.filter(s=>s.id!==n)}))},findById:async n=>{const t=i().scheduleList.find(s=>s.id===n);return t?Oe.create({createdAt:t.createdAt,endTimeInMs:t.endTimeInMs,funnelData:t.funnelData,id:t.id,itemId:t.itemId,itemName:t.itemName,scheduleDate:t.scheduleDate,sentAt:t.sentAt,simulationDelay:t.simulationDelay,startTimeInMs:t.startTimeInMs,status:t.status,targetChatId:t.targetChatId,targetChatName:t.targetChatName,type:t.type,uuidCode:t.uuidCode},new X(n)):null},findManyByStatus:async n=>i().scheduleList.filter(s=>s.status===n),findManySchedules:async()=>{const n=new Date().getTime();return i().scheduleList.filter(s=>{const o=new Date(s.scheduleDate).getTime()<=n,u=s.status==="scheduled",h=s.status==="pending";return o&&(u||h)})},getScheduledByChatId:async(n,t)=>{const s=i().scheduleList.filter(o=>o.targetChatId===n&&(!t||t===o.type)),a={};for(const o of s)Object.keys(a).indexOf(o.uuidCode)===-1&&(a[o.uuidCode]=[]),a[o.uuidCode].push(o);return a},getScheduledFunnelByFunnelId:async(n,t)=>i().scheduleList.find(a=>{var o;return a.targetChatId===n&&(a.status==="scheduled"||a.status==="pending")&&((o=a.funnelData)==null?void 0:o.funnelId)===t}),markScheduleAsSent:async({scheduleId:n})=>{await this.changeSchedulesStatus([{scheduleId:n,status:"sent"}])},removeAutoScheduledItems:async()=>{r({scheduleList:i().scheduleList.filter(n=>n.scheduledByUser)})},removeScheduledItemByChatAndUuidCode:async(n,t)=>{const s=i().scheduleList.filter(a=>a.targetChatId===n&&a.uuidCode===t).map(a=>a.id);for(const a of s)await i().deleteSchedule(a)},removeSentScheduledItems:async()=>{const n=i().scheduleList.filter(t=>t.status==="sent").map(t=>t.id);for(const t of n)await i().deleteSchedule(t)}}),{name:Ct,storage:ee(()=>this.zustandStorage),version:0}))}async rehydrateStore(){setTimeout(async()=>{await this._store.persist.rehydrate()},300)}get store(){return this._store}get hasSchedules(){return c.unstable_batchedUpdates(()=>this.store.getState().scheduleList.length>0)}get scheduleList(){return c.unstable_batchedUpdates(()=>this.store.getState().scheduleList)}}const Bt=(l,e,r)=>l.filter(i=>i.isEnabled).filter(i=>i.keywordRules.length>0).filter(i=>!(i.sendToContacts===!1&&r)).filter(i=>!(i.sendToGroups===!1&&e));function Pt(l){return l.replace(/[-[\]{}()*+?.\\^$|#]/g,"\\$&")}const Ot=l=>new RegExp(`\\b(?:\\s|\\p{P})*${Pt(l)}(?:\\p{P})*`,"u"),je=(l,e,r)=>{const i=A(r,{toLowerCase:!e});if(!i)return!1;const n=l.keywords.map(s=>A(s,{toLowerCase:!e})),t=()=>{try{return n.some(s=>Ot(s).test(i))}catch(s){const a="Invalid regular expression: ";if(s instanceof SyntaxError&&s.message.startsWith(a)){const[o,...u]=s.message.replace(a,"").split(" ").map(h=>h.trim());console.error({errorName:a.replace(": ",""),regexError:u.join(" "),regexTerm:o.replace(/:$/,"")})}else s instanceof Error?console.error(s.toString()):console.error(JSON.stringify(s));return n.some(o=>o.includes(i))}};switch(l.type){case"startsWith":return n.some(s=>i.startsWith(s));case"contains":return t();case"equals":return n.some(s=>i===s);case"notContains":return!t();default:return!1}},$t=(l,e,r)=>{const i=l.find(n=>n.type==="equals");return i?je(i,e,r):l.every(n=>je(n,e,r))},Rt={dummyTrigger:!1,filterTerm:"",selectedTriggerId:"",triggerList:[]},Ze="ZV:triggerStore";class Us{constructor(e,r={shouldMigrate:!1}){d(this,"_store");d(this,"useDashboardTriggerList",()=>L(this.store,e=>{const r=e.filterTerm,i=r.trim().length>0?e.triggerList.filter(t=>A(t.name,{toLowerCase:!0}).includes(A(r,{toLowerCase:!0}))):e.triggerList,n=e.selectedTriggerId;return{filteredTriggerList:i,filterTerm:r,selectedTriggerId:n}}));d(this,"useGetTriggerList",()=>L(this.store,e=>e.triggerList));d(this,"useGetTriggerCount",()=>L(this.store,e=>e.triggerList.length));d(this,"useGetFilteredTriggerList",()=>L(this.store,e=>e.triggerList.filter(r=>A(r.name,{toLowerCase:!0}).includes(A(e.filterTerm,{toLowerCase:!0})))));d(this,"useGetHasTriggers",()=>L(this.store,e=>e.triggerList.length>0));d(this,"useGetFilterTerm",()=>L(this.store,e=>e.filterTerm));d(this,"useGetSelectedTrigger",()=>L(this.store,e=>({selectedTriggerId:e.selectedTriggerId,dummyTrigger:e.dummyTrigger})));d(this,"add",(...e)=>c.unstable_batchedUpdates(()=>this.store.getState().add(...e)));d(this,"checkNewMessage",(...e)=>c.unstable_batchedUpdates(()=>this.store.getState().checkNewMessage(...e)));d(this,"delete",(...e)=>c.unstable_batchedUpdates(()=>this.store.getState().delete(...e)));d(this,"findById",(...e)=>c.unstable_batchedUpdates(()=>this.store.getState().findById(...e)));d(this,"findMany",()=>c.unstable_batchedUpdates(()=>this.store.getState().findMany()));d(this,"reorderList",(...e)=>c.unstable_batchedUpdates(()=>this.store.getState().reorderList(...e)));d(this,"save",(...e)=>c.unstable_batchedUpdates(async()=>this.store.getState().save(...e)));d(this,"select",(...e)=>c.unstable_batchedUpdates(()=>this.store.getState().select(...e)));d(this,"setFilter",(...e)=>c.unstable_batchedUpdates(()=>this.store.getState().setFilter(...e)));this.zustandStorage=e,this.options=r,this._store=J()(Q((i,n)=>({...Rt,toggleDummy:()=>i(t=>({dummyTrigger:!t.dummyTrigger})),add:async t=>{i(s=>({triggerList:[...s.triggerList,{...t.metadata,keywordRules:t.keywordRules.map(a=>({...a,keywords:a.keywords.map(o=>o.trim())}))}],filterTerm:"",selectedTriggerId:t.id}))},checkNewMessage:async({isGroup:t,isMyContact:s,messageContents:a})=>{const o=Bt(n().triggerList,t,s);for(const u of o)if($t(u.keywordRules,u.isCaseSensitive,a))return u;return null},delete:async t=>{i(s=>({triggerList:s.triggerList.filter(a=>a.id!==t),selectedTriggerId:"",filterTerm:""}))},findById:async t=>n().triggerList.find(a=>a.id===t)??null,findMany:async()=>n().triggerList,reorderList:async t=>{const{sourceIndex:s,destinationIndex:a}=t,o=n().triggerList,u=o.splice(s,1);o.splice(a,0,...u),i({triggerList:o})},save:async t=>{i(a=>({triggerList:a.triggerList.map(o=>o.id===t.id?{...o,...t}:o)}));const s=n().selectedTriggerId;s&&t.id===s&&n().toggleDummy()},select:async t=>i({selectedTriggerId:t}),setFilter:async t=>{i({filterTerm:t.trim()})}}),{name:Ze,storage:ee(()=>e),version:0})),this.options.shouldMigrate&&this.validateMigration(),e.addStorageListener(async()=>{await this.rehydrateStore()},[Ze])}async rehydrateStore(){setTimeout(async()=>{await this._store.persist.rehydrate()},300)}get store(){return this._store}get filteredList(){return c.unstable_batchedUpdates(()=>{const e=this.store.getState().filterTerm;return this.store.getState().triggerList.filter(i=>A(i.name,{toLowerCase:!0}).includes(A(e,{toLowerCase:!0})))})}get filterTerm(){return c.unstable_batchedUpdates(()=>this.store.getState().filterTerm)}get hasTriggers(){return c.unstable_batchedUpdates(()=>this.store.getState().triggerList.length>0)}get selectedTrigger(){return c.unstable_batchedUpdates(()=>this.store.getState().selectedTriggerId)}get triggerList(){return c.unstable_batchedUpdates(()=>this.store.getState().triggerList)}get triggerCount(){return c.unstable_batchedUpdates(()=>this.store.getState().triggerList.length)}migrateOldKeywordRuleType(e){switch(e){case"equals":return"equals";case"contains":return"contains";case"starts":return"startsWith";case"not_contains":return"notContains"}}migrateOldKeywordRules(e){return e.map(r=>({id:r.id,keywords:r.keywords.map(i=>i.trim()),type:this.migrateOldKeywordRuleType(r.type)}))}async migrateFromOldSchema(e){this.store.setState({triggerList:e.map(r=>({id:r.id.toString(),name:r.name,isFavorite:!1,funnelId:r.funnelId??null,isCaseSensitive:!r.ignoreCaseSensitive,isEnabled:!!r.enabled,keywordRules:this.migrateOldKeywordRules(r.keywordRules),millisecondsBeforeSend:(r.secondsBeforeSend??0)*1e3,sendToContacts:!r.dontSendToContact,sendToGroups:!r.dontSendToGroups,triggeredAt:null,webhook:""}))})}async validateMigration(e=!1){const r="migratedTriggerSchema",i=await this.zustandStorage.getParsedItem(r);if(i)return;const n="triggers",t=this.store.getState().triggerList;if(t.length>0&&e===!1)return;const a=await this.zustandStorage.getParsedItem(n);(!!(t.length===0&&a&&a.length>0)&&!i||e)&&(await this.zustandStorage.setItem(r,"true"),await this.migrateFromOldSchema(a??[])),e&&(e=!1)}}const zt={enabled:!1,payload:{max_date:null,popup:{actionButtonLink:"",actionButtonText:"",cancelText1:"",cancelText2:"",description:void 0,showCountdown:!1,title1:"",title2:"",videoLink:""},banner:{actionButtonLink:"",actionButtonText:"",cancelText:"",description:"",title:""}}},Vt={enabled:!1,payload:[]},Gt={enabled:!1,payload:[]},se={enabled:!1,payload:{"video-url":""}},Es={baseUrl:"https://zapvoice.com.br/uninstall-page",enableDynamicParamsInBaseUrl:!1},Yt={dummyTrigger:!1,flags:{crm:!1,"dashboard-audio-help-video":se,"dashboard-document-help-video":se,"dashboard-funnel-help-video":se,"dashboard-home-benefit-for-pro-video":se,"dashboard-home-help-video":se,"dashboard-label-help-video":se,"dashboard-media-help-video":se,"dashboard-message-help-video":se,"dashboard-trigger-help-video":se,"free-login":!0,"high-size-medias":!1,"key-warning-ad":!1,"key-warning-ad-block":zt,label:!1,"login-by-key":!0,modals:Vt,news:Gt,"redirect-uninstall-url":{baseUrl:"https://zapvoice.com.br/uninstall-page",enableDynamicParamsInBaseUrl:!0},"renew-plan-redirect":!1,"social-login":!1,"social-register":!1,tour:!1,"track-auth-events":!0,"track-backup-events":!0,"track-engagement-events":!0,"track-exception-events":!0,"track-funnel-events":!0,"track-item-sent-events":!0,"track-misc-events":!0,"track-page-events":!0,"track-trigger-events":!0,"trigger-webhooks":!1,"usage-limit":!0,"video-tutorial":se,"zap-saver":!1}},Ie="ZV:flags";class ws{constructor(e){d(this,"_store");d(this,"listeners",[]);d(this,"useGetFlags",()=>L(this.store,e=>e.flags));d(this,"useGetByName",e=>L(this.store,r=>r.getByName(e)));d(this,"getAll",(...e)=>c.unstable_batchedUpdates(async()=>this.store.getState().getAll(...e)));d(this,"getByName",(...e)=>c.unstable_batchedUpdates(()=>this.store.getState().getByName(...e)));d(this,"updateAll",(...e)=>c.unstable_batchedUpdates(async()=>this.store.getState().updateAll(...e)));this.zustandStorage=e,this._store=J()(Q((r,i)=>({...Yt,toggleDummy:()=>r(n=>({dummyTrigger:!n.dummyTrigger})),getAll:async()=>i().flags,getByName:n=>i().flags[n],updateAll:async n=>r({flags:{...i().flags,...n}})}),{name:Ie,storage:ee(()=>this.zustandStorage),version:0})),this.zustandStorage.addStorageListener(async()=>{await this.rehydrateStore()},[Ie])}addListener(e){this.listeners.push(e)}dispatchListeners(){for(const e of this.listeners)e()}async rehydrateStore(){setTimeout(async()=>{await this._store.persist.rehydrate();try{this.dispatchListeners()}catch(e){console.log(e)}},300)}get store(){return this._store}get flags(){return c.unstable_batchedUpdates(()=>this.store.getState().flags)}}const Ht=["create_flow","massive_dispatching","schedule_item","send_flow","send_funnel","send_trigger"],Wt={authError:null,authErrorMessage:null,deviceId:null,dummyTrigger:!1,isLoggedIn:!1,isPremium:!1,key:null,keyId:null,managerId:null,ownerId:null,phoneNumber:null,unauthorizedNumber:!1,userName:null,userProfilePic:null,wppVersion:null,permissions:Ht,isBasicPlan:!1,plan_id:""},qe="ZV:authStore";class ks{constructor(e,r,i,n={shouldMigrate:!1}){d(this,"_store");d(this,"listeners",[]);d(this,"useGetAuthData",()=>L(this.store,e=>({authError:e.authError,authErrorMessage:e.authErrorMessage,isLoggedIn:e.isLoggedIn,isPremium:e.isPremium,key:e.key,keyId:e.keyId,managerId:e.managerId,ownerId:e.ownerId,unauthorizedNumber:e.unauthorizedNumber,userName:e.userName,permissions:e.permissions,isBasicPlan:e.isBasicPlan,plan_id:e.plan_id,phoneNumber:e.phoneNumber})));d(this,"useGetPhoneNumber",()=>L(this.store,e=>e.phoneNumber));d(this,"useGetUserName",()=>L(this.store,e=>e.userName));d(this,"useGetUserProfilePic",()=>L(this.store,e=>e.userProfilePic));d(this,"getAuthData",(...e)=>c.unstable_batchedUpdates(async()=>this.store.getState().getAuthData(...e)));d(this,"login",(...e)=>c.unstable_batchedUpdates(async()=>this.store.getState().login(...e)));d(this,"logout",(...e)=>c.unstable_batchedUpdates(async()=>this.store.getState().logout(...e)));d(this,"refreshPremium",(...e)=>c.unstable_batchedUpdates(async()=>this.store.getState().refreshPremium(...e)));d(this,"setPhoneNumber",(...e)=>c.unstable_batchedUpdates(async()=>{this.store.getState().setPhoneNumber(...e)}));d(this,"setUserProfilePic",(...e)=>c.unstable_batchedUpdates(async()=>{this.store.getState().setUserProfilePic(...e)}));d(this,"setWppVersion",(...e)=>c.unstable_batchedUpdates(async()=>{this.store.getState().setWppVersion(...e)}));this.zustandStorage=e,this.fetchBackendAuthData=r,this.usageLimitStore=i,this.options=n,this._store=J()(Q((t,s)=>({...Wt,toggleDummy:()=>t(a=>({dummyTrigger:!a.dummyTrigger})),getAuthData:async()=>({authError:s().authError,authErrorMessage:s().authErrorMessage,isLoggedIn:s().isLoggedIn,isPremium:s().isPremium,key:s().key,keyId:s().keyId,managerId:s().managerId,ownerId:s().ownerId,unauthorizedNumber:s().unauthorizedNumber,userName:s().userName,permissions:s().permissions,isBasicPlan:s().isBasicPlan,plan_id:s().plan_id,phoneNumber:s().phoneNumber}),login:async({key:a,keyId:o,managerId:u,ownerId:h,shouldGetUsage:g})=>{const f=await this.zustandStorage.getParsedItem(Ie),m=!!f&&f.state.flags["free-login"];let v={authError:null,authErrorMessage:null,isLoggedIn:m,isPremium:!1,key:null,keyId:null,managerId:null,ownerId:null,unauthorizedNumber:!1,userName:m?"Usuário Gratuito":"",permissions:[],isBasicPlan:!1,plan_id:m?"ZV_FREE":"",phoneNumber:s().phoneNumber};if(a)try{v=await this.fetchBackendAuthData({key:A(a,{toLowerCase:!0}),phoneNumber:s().phoneNumber,userName:s().userName,wppVersion:s().wppVersion})}catch(k){console.error(k)}return g&&this.phoneNumber&&await this.usageLimitStore.verifySyncUsageLimit({...v,phoneNumber:this.phoneNumber}),t({...v,keyId:v.keyId??o,managerId:v.managerId??u,ownerId:v.ownerId??h}),v},logout:async()=>{const a={authError:null,authErrorMessage:null,isLoggedIn:!1,isPremium:!1,key:null,keyId:null,managerId:null,ownerId:null,unauthorizedNumber:!1,userName:"Usuário não logado",permissions:[],isBasicPlan:!1,plan_id:"",phoneNumber:s().phoneNumber};return t({...a}),a},refreshPremium:async a=>{const o=s().key,u=s().keyId,h=s().managerId,g=s().ownerId;return s().isLoggedIn?this.login({key:o,keyId:u,managerId:h,ownerId:g,shouldGetUsage:a}):this.logout()},setPhoneNumber:async a=>{t({phoneNumber:a})},setUserProfilePic:async a=>{t({userProfilePic:a})},setWppVersion:async a=>{t({wppVersion:a})}}),{name:qe,storage:ee(()=>this.zustandStorage),version:0})),this.options.shouldMigrate&&this.validateAuthMigration(),this.zustandStorage.addStorageListener(async()=>{this.rehydrateStore()},[qe])}addListener(e){this.listeners.push(e)}dispatchListeners(){for(const e of this.listeners)e()}async rehydrateStore(){setTimeout(async()=>{await this._store.persist.rehydrate();try{this.dispatchListeners()}catch(e){console.log(e)}},300)}get store(){return this._store}get authData(){return c.unstable_batchedUpdates(()=>({authError:this.store.getState().authError,authErrorMessage:this.store.getState().authErrorMessage,isLoggedIn:this.store.getState().isLoggedIn,isPremium:this.store.getState().isPremium,key:this.store.getState().key,keyId:this.store.getState().keyId,managerId:this.store.getState().managerId,ownerId:this.store.getState().ownerId,unauthorizedNumber:this.store.getState().unauthorizedNumber,userName:this.store.getState().userName,permissions:this.store.getState().permissions,isBasicPlan:this.store.getState().isBasicPlan,plan_id:this.store.getState().plan_id,phoneNumber:this.store.getState().phoneNumber}))}get deviceId(){return c.unstable_batchedUpdates(()=>this.store.getState().deviceId)}get authError(){return c.unstable_batchedUpdates(()=>this.store.getState().authError)}get authErrorMessage(){return c.unstable_batchedUpdates(()=>this.store.getState().authErrorMessage)}get isLoggedIn(){return c.unstable_batchedUpdates(()=>this.store.getState().isLoggedIn)}get isPremium(){return c.unstable_batchedUpdates(()=>this.store.getState().isPremium)}get key(){return c.unstable_batchedUpdates(()=>this.store.getState().key)}get phoneNumber(){return c.unstable_batchedUpdates(()=>this.store.getState().phoneNumber)}get wppVersion(){return c.unstable_batchedUpdates(()=>this.store.getState().wppVersion)}get userName(){return c.unstable_batchedUpdates(()=>this.store.getState().userName)}get userProfilePic(){return c.unstable_batchedUpdates(()=>this.store.getState().userProfilePic)}isEnablePermission(e){return c.unstable_batchedUpdates(()=>this.store.getState().permissions.includes(e))}async migrateFromOldSchema({key:e,deviceId:r}){if(this.store.setState({key:e?A(e,{toLowerCase:!0}):null,deviceId:r}),e){const i=await this.zustandStorage.getParsedItem(Ie),n=!!i&&i.state.flags["usage-limit"];this.login({key:e,keyId:null,managerId:null,ownerId:null,shouldGetUsage:n})}}async getOldDeviceId(){const e="deviceId",r=await this.zustandStorage.getParsedItem(e);if(!r){const i=et();return await this.zustandStorage.setItem(e,i),i}return r}async getOldKey(){return await this.zustandStorage.getParsedItem("chave")}async validateAuthMigration(){const e="migratedAuthData";if(await this.zustandStorage.getParsedItem(e))return;const i=this._store.getState().key;if(!!i)return;const t=await this.getOldKey(),s=await this.getOldDeviceId();!i&&!!t&&(await this.zustandStorage.setItem(e,"true"),await this.migrateFromOldSchema({key:A(t,{toLowerCase:!0}),deviceId:s}))}}function Ke(l){return l.split("").reverse().join("")}function jt(l){if(typeof l!="string")return l;const e=Ke(l),r=atob(e);return Ke(r)}class Ns extends Error{constructor(r,i="UNKNOWN"){super(r);d(this,"code");this.code=i}}function Zt({backendUsageLimit:l,currentUsageLimit:e}){let r=!1;for(const[i,n]of Object.entries(l)){const t=e[i];if(t.sent!==n.sent){r=!0;break}if(t.max!==n.max){r=!0;break}}return{shouldUpdateBackendUsageLimit:r}}const Cs={audio:{max:-1,sent:0},bulkMessages:{max:-1,sent:0},document:{max:-1,sent:0},flow:{max:-1,sent:0},funnel:{max:-1,sent:0},media:{max:-1,sent:0},message:{max:-1,sent:0},scheduleItem:{max:-1,sent:0}},qt={audio:{max:20,sent:0},bulkMessages:{max:2,sent:0},document:{max:20,sent:0},media:{max:20,sent:0},message:{max:20,sent:0},funnel:{max:5,sent:0},flow:{max:5,sent:0},scheduleItem:{max:5,sent:0}},Kt={dummyTrigger:!1,usageLimit:qt,expiresAt:""},Xe="ZV:usageLimitStore";class Bs{constructor(e,r,i,n,t){d(this,"_store");d(this,"listeners",[]);d(this,"useGetUsageLimit",()=>L(this.store,e=>e.usageLimit));d(this,"checkItemUsageLimit",(...e)=>c.unstable_batchedUpdates(async()=>this.store.getState().checkItemUsageLimit(...e)));d(this,"verifySyncUsageLimit",(...e)=>c.unstable_batchedUpdates(async()=>this.store.getState().verifySyncUsageLimit(...e)));d(this,"updateItemUsageLimit",(...e)=>c.unstable_batchedUpdates(async()=>this.store.getState().updateItemUsageLimit(...e)));this.zustandStorage=e,this.fetchBackendUsageLimitData=r,this.fetchBackendGetUsageLimitData=i,this.fetchBackendSyncUsageLimit=n,this.scheduleStore=t,this._store=J()(Q((s,a)=>({...Kt,toggleDummy:()=>s(o=>({dummyTrigger:!o.dummyTrigger})),checkItemUsageLimit: async ({ itemType }) => { return { canProceed: true }; };const m=u.usageLimit;let v=0;if(o==="scheduleItem"){const U=(await this.scheduleStore.findManyByStatus("scheduled")).filter(D=>D.scheduledByUser);v=new Set(U.map(D=>D.uuidCode)).size}else v=m[o].sent;const k=m[o].max;return k<0?{canProceed:!0}:v>=k?{canProceed:!1}:{canProceed:!0}},getUsageLimit:()=>a().usageLimit,verifySyncUsageLimit:async o=>{const u=this._store.getState(),h=u.expiresAt.trim().length>0?K(u.expiresAt):void 0,g=K(),f=h?g.isAfter(h):!0,m=await this.fetchBackendGetUsageLimitData({hasError:!!o.authError,isBasic:o.isBasicPlan,managerId:o.managerId??"",phoneNumber:o.phoneNumber??"",planId:o.plan_id});if(f){const k=m.limits??u.usageLimit;if(m.isExpired)c.unstable_batchedUpdates(()=>{var I;s({usageLimit:k,expiresAt:((I=m.expires_at)==null?void 0:I.split("T")[0])??u.expiresAt})});else return c.unstable_batchedUpdates(()=>{var I;s({usageLimit:k,expiresAt:((I=m.expires_at)==null?void 0:I.split("T")[0])??u.expiresAt})}),k;return u.usageLimit}const{limits:v}=await this.fetchBackendSyncUsageLimit({extensionLimits:u.usageLimit,phoneNumber:o.phoneNumber??"",planId:o.plan_id});return v?(c.unstable_batchedUpdates(()=>{s({usageLimit:v})}),v):u.usageLimit},updateItemUsageLimit:async({itemType:o,action:u="increase",scheduledItems:h,authStoreState:g})=>{const f=this._store.getState(),m=await this.fetchBackendUsageLimitData({action:u,hasError:!!g.authError,isBasic:g.isBasicPlan,itemType:o,managerId:g.managerId??"",phoneNumber:g.phoneNumber??"",planId:g.plan_id,scheduledItems:h});if(o==="scheduleItem"){const I=(await this.scheduleStore.findManyByStatus("scheduled")).filter(M=>M.scheduledByUser),U=new Set(I.map(M=>M.uuidCode)).size;f.usageLimit[o].sent=U}else{const k=u==="increase"?1:-1;f.usageLimit[o].sent=f.usageLimit[o].sent+k}const v=m;if(m.status&&m.limits){const{shouldUpdateBackendUsageLimit:k}=Zt({currentUsageLimit:f.usageLimit,backendUsageLimit:m.limits});if(K().isAfter(K(f.expiresAt)))f.usageLimit=m.limits;else if(k){const U=await this.fetchBackendSyncUsageLimit({extensionLimits:f.usageLimit,planId:g.plan_id,phoneNumber:g.phoneNumber??""});U.limits&&(f.usageLimit=U.limits,v.limits=U.limits)}}else if(m.errorType==="MAX_LIMIT_REACHED"){const k=f.usageLimit[o].sent,I=f.usageLimit[o].max;k<I&&(f.usageLimit[o].sent=I)}else if(m.errorType==="Unable to make the request")return s(f),{...m,limits:f.usageLimit};return m.expires_at&&(f.expiresAt=m.expires_at.split("T")[0]),s(f),v}}),{name:Xe,storage:ee(()=>this.zustandStorage),version:0})),this.zustandStorage.addStorageListener(async()=>{this.rehydrateStore()},[Xe])}addListener(e){this.listeners.push(e)}dispatchListeners(){for(const e of this.listeners)e()}async rehydrateStore(){setTimeout(async()=>{await this._store.persist.rehydrate();try{this.dispatchListeners()}catch(e){console.log(e)}},300)}get store(){return this._store}}const Xt={clientId:void 0,dummyTrigger:!1,keyId:null,managerId:null,userId:null,whatsappIsBeta:null,whatsappVersion:null,zapvoiceVersion:null},Je="ZV:trackerStore";class Ps{constructor(e){d(this,"_store");d(this,"listeners",[]);d(this,"getClientId",(...e)=>c.unstable_batchedUpdates(async()=>this.store.getState().getClientId(...e)));d(this,"getSessionCount",(...e)=>c.unstable_batchedUpdates(async()=>this.store.getState().getSessionCount(...e)));d(this,"getSessionId",(...e)=>c.unstable_batchedUpdates(async()=>this.store.getState().getSessionId(...e)));d(this,"getTrackerUserProperties",(...e)=>c.unstable_batchedUpdates(async()=>this.store.getState().getTrackerUserProperties(...e)));this.zustandStorage=e,this._store=J()(Q((r,i)=>({...Xt,toggleDummy:()=>r(n=>({dummyTrigger:!n.dummyTrigger})),getSessionCount:async n=>this.zustandStorage.getParsedSessionItem(n),getSessionId:async n=>await this.zustandStorage.getParsedSessionItem(n),getClientId:async()=>i().clientId,getTrackerUserProperties:async()=>({keyId:i().keyId,managerId:i().managerId,userId:i().userId,whatsappVersion:i().whatsappVersion,whatsappIsBeta:i().whatsappIsBeta,zapvoiceVersion:i().zapvoiceVersion}),setClientId:async n=>(r({clientId:n}),n),setKeyId:async n=>r({keyId:n}),setManagerId:async n=>r({managerId:n}),setSessionCount:async(n,t)=>(this.zustandStorage.setSessionItem(n,String(t)),t),setSessionId:async(n,t)=>(this.zustandStorage.setSessionItem(n,String(t)),t),setUserId:async n=>r({userId:n}),setTrackerUserProperties:async n=>r({...n}),setWhatsAppIsBeta:async n=>r({whatsappIsBeta:n}),setWhatsAppVersion:async n=>r({whatsappVersion:n}),setZapvoiceVersion:async n=>r({zapvoiceVersion:n})}),{name:Je,storage:ee(()=>this.zustandStorage),version:0})),this.zustandStorage.addStorageListener(async()=>{this.rehydrateStore()},[Je])}addListener(e){this.listeners.push(e)}dispatchListeners(){this.listeners.forEach(e=>e())}async rehydrateStore(){setTimeout(async()=>{await this._store.persist.rehydrate();try{this.dispatchListeners()}catch(e){console.log(e)}},300)}get store(){return this._store}setClientId(...e){return this.store.getState().setClientId(...e)}setKeyId(...e){return this.store.getState().setKeyId(...e)}setManagerId(...e){return this.store.getState().setManagerId(...e)}setSessionCount(...e){return this.store.getState().setSessionCount(...e)}setSessionId(...e){return this.store.getState().setSessionId(...e)}setUserId(...e){return this.store.getState().setUserId(...e)}setTrackerUserProperties(...e){return this.store.getState().setTrackerUserProperties(...e)}setWhatsAppIsBeta(...e){return this.store.getState().setWhatsAppIsBeta(...e)}setWhatsAppVersion(...e){return this.store.getState().setWhatsAppVersion(...e)}setZapvoiceVersion(...e){return this.store.getState().setZapvoiceVersion(...e)}}const Jt=["auth:login:init","auth:login:end"],Qt=["backup:export","backup:import"],es=["engagement:help_clicked"],ts=["funnel:scheduled"],ss=["item_sent:audio","item_sent:document","item_sent:media","item_sent:message"],rs=["misc:clear_all_data"],is=["page_view"],as=["trigger:dispatched","trigger:webhook_sent"];function ns(l){return typeof l=="string"&&Jt.includes(l)}function os(l){return typeof l=="string"&&Qt.includes(l)}function ds(l){return typeof l=="string"&&es.includes(l)}function us(l){return typeof l=="string"&&l.startsWith("exception")}function cs(l){return typeof l=="string"&&ts.includes(l)}function ls(l){return typeof l=="string"&&ss.includes(l)}function hs(l){return typeof l=="string"&&rs.includes(l)}function gs(l){return typeof l=="string"&&is.includes(l)}function ms(l){return typeof l=="string"&&as.includes(l)}var nt={};(function(l){function e(a){a&&a.options&&clearTimeout(a.options.timer)}function r(a,o,u,h){var g={timer:void 0,lastArgs:[]},f=function(){for(var m=this,v=[],k=0;k<arguments.length;k++)v[k]=arguments[k];g.lastArgs=v,g.timer?clearTimeout(g.timer):o&&u.apply(this,g.lastArgs),g.timer=setTimeout(function(){o||u.apply(m,g.lastArgs),g.timer=void 0},a)};return h&&(f=f.bind(h)),f.options=g,f}function i(a,o,u,h){var g;Object.defineProperty(u,h,{configurable:!0,enumerable:!1,get:function(){return g},set:function(f){g=r(a,o,f,this)}})}function n(a,o,u){var h=u.value;return u.value=r(a,o,h),u}function t(a,o){for(var u=[],h=2;h<arguments.length;h++)u[h-2]=arguments[h];if(u.length===0)throw new Error("function applied debounce decorator should be a method");if(u.length===1)throw new Error("method applied debounce decorator should have valid name");var g=u[0],f=u[1],m=u.length===3&&u[2]?u[2]:Object.getOwnPropertyDescriptor(g,f);if(m)return n(a,o,m);i(a,o,g,f)}function s(){for(var a=[],o=0;o<arguments.length;o++)a[o]=arguments[o];var u=500,h=!1;if(a.length&&(typeof a[0]=="number"||typeof a[0]=="object"&&a[0].leading!==void 0)){typeof a[0]=="number"&&(u=a[0]);var g=void 0;return typeof a[0]=="object"&&a[0].leading!==void 0&&(g=a[0]),1<a.length&&typeof a[1]=="object"&&a[1].leading!==void 0&&(g=a[1]),g&&(h=g.leading),function(){for(var f=[],m=0;m<arguments.length;m++)f[m]=arguments[m];return t.apply(void 0,[u,h].concat(f))}}return t.apply(void 0,[u,h].concat(a))}Object.defineProperty(l,"__esModule",{value:!0}),l.cancel=e,l.debounce=s})(nt);var ps=Object.defineProperty,fs=Object.getOwnPropertyDescriptor,ys=(l,e,r,i)=>{for(var n=fs(e,r),t=l.length-1,s;t>=0;t--)(s=l[t])&&(n=s(e,r,n)||n);return n&&ps(e,r,n),n};function Qe(l=0,e=2147483647){return Math.floor(Math.random()*(e-l+1)+l)}const Ss="platform platformVersion architecture model uaFullVersion bitness fullVersionList wow64".split(" ");var re;const ot=(re=class{constructor(e,r,i,n){d(this,"events",[]);d(this,"userProperties",{});d(this,"lastTime",Date.now());d(this,"hitsCount",1);d(this,"documentTitle","");this.trackingId=e,this.trackerRepository=r,this.flagsStore=i,this.sendBeacon=n}async clientState(){const e=await this.trackerRepository.getClientId(),r=!e,i=e??Qe(1e9)+"."+Math.floor(Date.now()/1e3),n=await this.trackerRepository.setClientId(i);return{firstVisit:r,cid:n}}async sid(){const e=`${this.trackingId}_sid`,r=await this.trackerRepository.getSessionId(e)??Math.floor(Date.now()/1e3);return await this.trackerRepository.setSessionId(e,r)}async sct(){const e=`${this.trackingId}_sct`,r=await this.trackerRepository.getSessionCount(e)??0;return await this.trackerRepository.setSessionCount(e,r+1)}async getClientHints(){var r;return await((r=navigator.userAgentData)==null?void 0:r.getHighEntropyValues(Ss))}async getHeader(){const{cid:e,firstVisit:r}=await this.clientState(),i=await this.sid(),n=await this.sct(),t={v:2,tid:this.trackingId,_p:re.pageLoadHash,cid:e,_fv:r?1:void 0,ul:(navigator.language||"").toLowerCase()||void 0,sr:typeof screen<"u"?`${screen.width}x${screen.height}`:void 0,_s:this.hitsCount++,sid:i,sct:n,seg:1,dl:location.href,dr:typeof document<"u"?document.referrer:"",dt:this.documentTitle||typeof document<"u"?document.title:"Service Worker"};return await this.getClientHints().then(s=>{var a,o;s&&Object.assign(t,{uaa:s.architecture??"",uab:s.bitness??"",uafvl:((o=(a=s.fullVersionList)==null?void 0:a.map(function(u){return encodeURIComponent(u.brand||"")+";"+encodeURIComponent(u.version||"")}))==null?void 0:o.join("|"))??"",uamb:s.mobile?"1":"0",uam:s.model??"",uap:s.platform??"",uapv:s.platformVersion??"",uaw:s.wow64?"1":"0"})}),t}async getUserProperties(){const e=this.userProperties;this.userProperties={};const r=Object.entries(e).filter(([,n])=>typeof n<"u").map(([n,t])=>typeof t=="number"?[`upn.${n}`,String(t)]:[`up.${n}`,String(t)]),i=await this.trackerRepository.getTrackerUserProperties();return i.keyId&&r.push(["up.zv_key_id",i.keyId]),i.managerId&&r.push(["up.zv_manager_id",i.managerId]),i.userId&&r.push(["user_id",i.userId]),i.whatsappIsBeta&&r.push(["up.zv_whatsapp_is_beta",String(i.whatsappIsBeta)]),i.whatsappVersion&&r.push(["up.zv_whatsapp_version",i.whatsappVersion]),i.zapvoiceVersion&&r.push(["up.zv_zapvoice_version",i.zapvoiceVersion]),r}async processEvents(){const e=this.events;if(this.events=[],!e.length)return;const r=e.map(([t,s,a])=>{const o=[];if(o.push(["en",t]),o.push(["_ee","1"]),s)for(const u in s){const h=s[u];typeof h>"u"||h===null||(typeof h=="number"?o.push([`epn.${u}`,String(h)]):o.push([`ep.${u}`,String(h)]))}return o.push(["_et",String(a)]),o}),i=Object.entries(await this.getHeader()).filter(([,t])=>typeof t<"u").map(([t,s])=>[t,String(s)]);i.push(...await this.getUserProperties());const n=new URLSearchParams(i);if(r.length===1){for(const[s,a]of r[0])n.append(s,a);const t=`${re.collectURL}?${n.toString()}`;this.sendBeacon(t)}else{const t=r.map(s=>new URLSearchParams(s).toString());this.sendBeacon(`${re.collectURL}?${n.toString()}`,t.join(`
`))}}shouldTrackEvent(e){return ns(e)?this.flagsStore.getByName("track-auth-events"):os(e)?this.flagsStore.getByName("track-backup-events"):ds(e)?this.flagsStore.getByName("track-engagement-events"):us(e)?this.flagsStore.getByName("track-exception-events"):cs(e)?this.flagsStore.getByName("track-funnel-events"):ls(e)?this.flagsStore.getByName("track-item-sent-events"):hs(e)?this.flagsStore.getByName("track-misc-events"):gs(e)?this.flagsStore.getByName("track-page-events"):ms(e)?this.flagsStore.getByName("track-trigger-events"):!1}async trackEvent(e,r){if(this.shouldTrackEvent(e)){const i=Date.now(),n=i-this.lastTime;this.lastTime=i,this.events.push([e,r,n]),await this.processEvents()}}trackException(e,r){this.trackEvent(e,r)}setUserProperty(e,r){this.userProperties[e]=r}},d(re,"collectURL","https://www.google-analytics.com/g/collect"),d(re,"pageLoadHash",Qe()),re);ys([nt.debounce(1e3)],ot.prototype,"processEvents");let Is=ot;const Os=(l,e,r)=>new Is(jt("H1ySadUOH1EWI5EN"),l,e,r),$s=()=>{let l=chrome.runtime.id;try{const e=window.localStorage.getItem("ZV:extensionId");e&&(l=e)}catch(e){e instanceof Error&&e.toString()!=="ReferenceError: window is not defined"&&console.log(e)}if(!l)throw new Error("extensionId not found");return l};export{It as $,Fe as A,Ns as B,ws as C,mt as D,ne as E,w as F,Ht as G,Cs as H,As as I,Bs as J,ks as K,Ps as L,Ne as M,Ts as N,vs as O,Ms as P,Us as Q,_s as R,Ue as S,Ce as T,X as U,Ds as V,Fs as W,$s as X,qt as Y,Oe as Z,yt as _,pt as a,le as a0,Pt as a1,De as a2,_t as a3,$t as a4,Ft as b,At as c,Et as d,Nt as e,wt as f,Rt as g,Os as h,Mt as i,ke as j,we as k,Ae as l,Be as m,A as n,Pe as o,Ee as p,je as q,K as r,Yt as s,zt as t,Vt as u,et as v,Gt as w,se as x,Es as y,jt as z};
