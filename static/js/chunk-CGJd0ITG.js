var P=Object.defineProperty;var F=(t,e,s)=>e in t?P(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var S=(t,e,s)=>F(t,typeof e!="symbol"?e+"":e,s);import{C,z as k,G as y,r as M,B as W,H as v,I as q,J as j,K as G,L as V,h as z,N as K,O as $,P as H,Q as J,R as Y,V as X,W as Z,X as Q}from"./chunk-Oea2Ib37.js";import{Z as l,g as ee}from"./chunk-DtvdEgkE.js";import{c as te,p as ae,b as se,a as b,u as L}from"./chunk-CdV9K1BU.js";const I=new C(new l),re="CHAVE BLOQUEADA",ne="CHAVE EXPIRADA",oe="USUÁRIO NÃO ENCONTRADO",ie="ASSINATURA NÃO ENCONTRADA",ce="CHAVE DESATIVADA",N=async({key:t,phoneNumber:e,userName:s,wppVersion:o})=>{var r,c,m,d,n;try{const u=k("oRHdwNnOv8SYwlmL6FGc29WajVmLj9WbuImc"),g=await fetch(`${u}/extension/v3/key`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({authKey:t,phoneNumber:e,wppVersion:o})}),a=await g.json(),i=!!a.numberWarning;if(!g.ok)return(r=a.data.message)!=null&&r.startsWith(re)?{authError:"restrictedKey",authErrorMessage:"Chave bloqueada",isBasicPlan:a.isBasicPlan??!1,isLoggedIn:!0,isPremium:!0,key:t,keyId:a.data.keyId,managerId:a.data.managerId,ownerId:a.data.ownerId,permissions:a.data.permissions??y,plan_id:a.data.plan_id,unauthorizedNumber:i,userName:a.data.username,phoneNumber:e}:(c=a.data.message)!=null&&c.startsWith(ce)?{authError:"inactiveKey",authErrorMessage:"Chave Inativa",isBasicPlan:a.isBasicPlan??!1,isLoggedIn:!0,isPremium:!0,key:t,keyId:a.data.keyId,managerId:a.data.managerId,ownerId:a.data.ownerId,permissions:a.data.permissions??y,plan_id:a.data.plan_id,unauthorizedNumber:i,userName:a.data.username,phoneNumber:e}:(m=a.data.message)!=null&&m.startsWith(ne)?{authError:"expiredKey",authErrorMessage:"Chave expirada",isBasicPlan:a.isBasicPlan??!1,isLoggedIn:!0,isPremium:!0,key:t,keyId:a.data.keyId,managerId:a.data.managerId,ownerId:a.data.ownerId,permissions:a.data.permissions??y,plan_id:a.data.plan_id,unauthorizedNumber:i,userName:a.data.username,phoneNumber:e}:(d=a.data.message)!=null&&d.startsWith(oe)?{authError:"userNotFound",authErrorMessage:"Usuário não encontrado",isBasicPlan:a.isBasicPlan??!1,isLoggedIn:!1,isPremium:!1,key:t,keyId:a.data.keyId,managerId:a.data.managerId,ownerId:a.data.ownerId,permissions:a.data.permissions??y,plan_id:a.data.plan_id,unauthorizedNumber:i,userName:a.data.username,phoneNumber:e}:(n=a.data.message)!=null&&n.startsWith(ie)?{authError:"managerNotFound",authErrorMessage:"Assinatura não encontrada",isBasicPlan:a.isBasicPlan??!1,isLoggedIn:!1,isPremium:!1,key:t,keyId:a.data.keyId,managerId:a.data.managerId,ownerId:a.data.ownerId,permissions:a.data.permissions??y,plan_id:a.data.plan_id,unauthorizedNumber:i,userName:a.data.username,phoneNumber:e}:{authError:"unknown",authErrorMessage:"Chave com problema desconhecido",isBasicPlan:a.isBasicPlan??!1,isLoggedIn:!0,isPremium:!0,key:t,keyId:a.data.keyId,managerId:a.data.managerId,ownerId:a.data.ownerId,permissions:a.data.permissions??y,plan_id:a.data.plan_id,unauthorizedNumber:i,userName:a.data.username??s??"Usuário",phoneNumber:e};let f=!1;if(I){const p=I.flags["key-warning-ad-block"],A=M(p.payload.max_date).endOf("day").isBefore(new Date,"second");if(f=i&&p.enabled&&A,f)return{authError:"unathorizedNumber",authErrorMessage:"Chave atrelada a outro número de telefone",isBasicPlan:a.isBasicPlan??!1,isLoggedIn:!0,isPremium:!0,key:t,keyId:a.data.keyId,managerId:a.data.managerId,ownerId:a.data.ownerId,permissions:a.data.permissions??y,plan_id:a.data.plan_id,unauthorizedNumber:i,userName:a.data.username,phoneNumber:e}}return{authError:null,authErrorMessage:null,isPremium:!a.isFreePlan,isBasicPlan:a.isBasicPlan??!1,isLoggedIn:!0,key:t,keyId:a.data.keyId,managerId:a.data.managerId,ownerId:a.data.ownerId,permissions:a.data.permissions??y,plan_id:a.data.plan_id,unauthorizedNumber:i,userName:a.data.username,phoneNumber:e}}catch(u){throw u instanceof Error?u.message==="Failed to fetch"?new Error("FAILED_TO_FETCH"):new Error(u.toString()):new Error(JSON.stringify(u))}};class B extends W{constructor(e){super(e,"FAILED_TO_FETCH")}}const _=async({action:t,hasError:e,itemType:s,phoneNumber:o,planId:r,scheduledItems:c})=>{const m=o??"",d=I.getByName("unlimited-usage");try{const n=k("oRHdwNnOv8SYwlmL6FGc29WajVmLj9WbuImc"),u=await fetch(`${n}/extension/v3/usage`,{method:"POST",headers:{"Content-Type":"application/json","x-app-date":new Date().toLocaleString("pt-BR")},body:JSON.stringify({action:t,itemType:s,phoneNumber:m,planId:r,hasError:e,scheduledItems:c})});try{const g=await u.json(),a={audio:"áudios",bulkMessages:"disparos em massa",document:"documentos",flow:"fluxos",funnel:"funis",media:"mídias",message:"mensagens",scheduleItem:"agendamentos de itens simultâneos"};if(!u.ok){const{data:p}=g;return p.errorType==="MAX_LIMIT_REACHED"?{limits:null,status:!1,errorType:"MAX_LIMIT_REACHED",message:s==="scheduleItem"?`O limite de ${a[s]} foi alcançado`:`O limite diário de envio de ${a[s]} foi alcançado`}:{limits:null,status:!1,errorType:p.errorType??"UNKNOWN_ERROR",message:p.message}}const{limits:i,expires_at:f}=g;let w="";return i!=null&&i[s].max&&!d&&(w=`, você ainda pode enviar ${i[s].max-i[s].sent} ${a[s]}`),{limits:d?v:i,status:!0,message:`Mensagem enviada${w}`,expires_at:f}}catch{return{limits:null,status:!1,errorType:"Incorrect response type",message:"Incorrect response type"}}}catch(n){throw console.error(n),n instanceof Error?n.message==="Failed to fetch"?new B:new Error(n.toString()):new Error(JSON.stringify(n))}},D=async({hasError:t,isBasic:e,managerId:s,phoneNumber:o,planId:r})=>{const c=o??"",m=I.getByName("unlimited-usage");try{const d=k("oRHdwNnOv8SYwlmL6FGc29WajVmLj9WbuImc"),n=await fetch(`${d}/extension/v3/get-usage`,{method:"POST",headers:{"Content-Type":"application/json","x-app-date":new Date().toLocaleString("pt-BR")},body:JSON.stringify({hasError:t,isBasic:e,managerId:s,phoneNumber:c,planId:r})});try{const u=await n.json();if(!n.ok){const{data:f}=u;return{limits:null,status:!1,errorType:f.errorType??"UNKNOWN_ERROR",isExpired:!0}}const{limits:g,expires_at:a,isExpired:i}=u;return{limits:m?v:g,status:!0,expires_at:a,isExpired:i}}catch{return{limits:null,status:!1,errorType:"Incorrect response type",isExpired:!0}}}catch(d){let n="";return d instanceof Error?d.message==="Failed to fetch"?n=`Unable to make the request - ${d.message}`:n=`Unable to make the request - ${d.toString()}`:n=`Unable to make the request - ${JSON.stringify(d)}`,console.error(n),{limits:null,status:!1,errorType:n??"UNKNOWN_ERROR",isExpired:!0}}},T=async({extensionLimits:t,phoneNumber:e,planId:s})=>{const o=e??"";try{const r=k("oRHdwNnOv8SYwlmL6FGc29WajVmLj9WbuImc"),c=await fetch(`${r}/extension/v3/sync-usage`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({extensionLimits:t,phoneNumber:o,planId:s})});try{const m=await c.json();if(!c.ok){const{data:n}=m;return{limits:null,status:!1,errorType:n.errorType??"UNKNOWN_ERROR"}}const{limits:d}=m;return{limits:d,status:!0}}catch{return{limits:null,status:!1,errorType:"Incorrect response type"}}}catch(r){let c="";return r instanceof Error?r.message==="Failed to fetch"?c="Unable to make the request - "+r.message:c="Unable to make the request - "+r.toString():c="Unable to make the request - "+JSON.stringify(r),console.error(c),{limits:null,status:!1,errorType:c??"UNKNOWN_ERROR"}}},de=new q(new l),ue=new j(new l,_,D,T,de),R=new G(new l,N,ue,{shouldMigrate:!0}),le=new V(new l);class me{constructor(){S(this,"trackerStore",le)}async getClientId(...e){return this.trackerStore.getClientId(...e)}async getSessionCount(...e){return this.trackerStore.getSessionCount(...e)}async getSessionId(...e){return this.trackerStore.getSessionId(...e)}async getTrackerUserProperties(...e){return this.trackerStore.getTrackerUserProperties(...e)}async setClientId(...e){return this.trackerStore.setClientId(...e)}async setKeyId(...e){return this.trackerStore.setKeyId(...e)}async setManagerId(...e){return this.trackerStore.setManagerId(...e)}async setSessionCount(...e){return this.trackerStore.setSessionCount(...e)}async setSessionId(...e){return this.trackerStore.setSessionId(...e)}async setUserId(...e){return this.trackerStore.setUserId(...e)}async setTrackerUserProperties(...e){return this.trackerStore.setTrackerUserProperties(...e)}async setWhatsAppIsBeta(...e){return this.trackerStore.setWhatsAppIsBeta(...e)}async setWhatsAppVersion(...e){return this.trackerStore.setWhatsAppVersion(...e)}async setZapvoiceVersion(...e){return this.trackerStore.setZapvoiceVersion(...e)}}const he={colors:"border-l-item-audio bg-item-audio-light/30 zv-dark:bg-item-audio-light/10",name:"Áudios",path:"/audios",textColor:"text-item-audio"},ge={colors:"border-l-accent-foreground bg-accent/30 zv-dark:bg-accent/10",name:"Backups",path:"/backups",textColor:"text-accent-foreground"},pe={name:"CRM",path:"/crm",colors:"border-l-item-funnel bg-accent-foreground/65 zv-dark:bg-accent-foreground/15",textColor:"bg-gradient-to-r from-item-funnel/80 to-item-trigger bg-clip-text text-transparent"},O={name:"Login",path:"/login",colors:"",textColor:""},ye={colors:"border-l-item-document bg-item-document-light/30 zv-dark:bg-item-document-light/10",name:"Documentos",path:"/documents",textColor:"text-item-document"},fe={colors:"border-l-item-trigger bg-gradient-dashboard-sidebar-flow/10 zv-dark:gradient-dashboard-sidebar-flow-dark bg-[length:100%_100%] hover:bg-[length:400%_100%] transition-all duration-300",name:"Fluxos",path:"/flows",textColor:"bg-gradient-dashboard-sidebar-flow bg-clip-text text-transparent"},Se={colors:"border-l-item-funnel bg-item-funnel-light/30 zv-dark:bg-item-funnel-light/10",name:"Funis",path:"/funnels",textColor:"text-item-funnel"},Ee={colors:"border-l-accent-foreground bg-accent/30 zv-dark:bg-accent/10",name:"Início",path:"/home",textColor:"text-accent-foreground"},Ie={name:"Etiquetas",path:"/labels",colors:"border-l-accent-foreground bg-accent-foreground/20 zv-dark:bg-accent/65",textColor:"text-primary"},ke={colors:"border-l-item-media bg-item-media-light/30 zv-dark:bg-item-media-light/10",name:"Mídias",path:"/medias",textColor:"text-item-media"},Re={colors:"border-l-item-message bg-item-message-light/30 zv-dark:bg-item-message-light/10",name:"Mensagens",path:"/messages",textColor:"text-item-message"},we={name:"Ops...",path:"/not-found",colors:"",textColor:""},be={colors:"border-l-item-trigger bg-item-trigger-light/30 zv-dark:bg-item-trigger-light/10",name:"Gatilhos",path:"/triggers",textColor:"text-item-trigger"},Le={"/login":O,"/home":Ee,"/messages":Re,"/audios":he,"/medias":ke,"/documents":ye,"/funnels":Se,"/triggers":be,"/flows":fe,"/crm":pe,"/labels":Ie,"/backups":ge},xe={currentRoute:O},x="ZV:route";class Ue{constructor(e,s){S(this,"_store");S(this,"useGetCurrentRoute",()=>L(this.store,e=>e.currentRoute));S(this,"useSetRoute",()=>L(this.store,e=>e.setRoute));S(this,"setRoute",e=>b.unstable_batchedUpdates(()=>this.store.getState().setRoute(e)));this.zustandStorage=e,this.tracker=s,this._store=te()(ae(o=>({...xe,setRoute:async r=>(this.tracker.trackEvent("page_view",{zv_page_name:r,zv_scope:"dashboard"}),o({currentRoute:Le[r]??we}))}),{name:x,storage:se(()=>this.zustandStorage),version:0})),e.addStorageListener(async()=>{await this.rehydrateStore()},[x])}async rehydrateStore(){setTimeout(async()=>{await this._store.persist.rehydrate()},300)}get store(){return this._store}get currentRoute(){return b.unstable_batchedUpdates(()=>this.store.getState().currentRoute)}}const ve=(t,e)=>{try{return fetch(t,{method:"POST",body:e}),!0}catch{return!1}},Ne=z(new me,I,ve),Be=new Ue(new l,Ne),ut=new K(new l,{shouldMigrate:!0}),lt=new $(new l,{shouldCheckAndRepair:!0}),mt=new H(new l,{shouldMigrate:!0}),ht=new J(new l,{shouldMigrate:!0}),gt=new Y(new l,{shouldMigrate:!0}),pt=new X(new l,{shouldMigrate:!0}),yt=new Z(new l,{shouldMigrate:!0});function h(t){return chrome.runtime.onMessage.addListener(t),chrome.runtime.onMessageExternal.addListener(t),{removeListener:()=>{chrome.runtime.onMessage.removeListener(t),chrome.runtime.onMessageExternal.removeListener(t)}}}const _e=async(...[t,,e])=>{if(t.type==="Auth:Request:FetchBackendAuthData")try{const s=await N(t.data);e({type:"Auth:Response:FetchBackendAuthData",data:s})}catch{const o=R.authData;e({type:"Auth:Response:FetchBackendAuthData",data:o})}};async function De(){const t=_e,{removeListener:e}=h(t);return{removeListener:e}}const Te=t=>async(...[e])=>{e.type==="Auth:Request:FinishExternalLogin"&&t(e.data)};function Oe(t){const e=Te(t),{removeListener:s}=h(e);return{removeListener:s}}const Ae={listenFetchBackendAuthDataExternalRequest:De,listenFinishExternalLoginRequest:Oe},Pe=async({data:t,eventName:e,keyId:s,userId:o})=>{try{const r=k("oRHdwNnOv8SYwlmL6FGc29WajVmLj9WbuImc");return(await fetch(`${r}/dmg/dashboard/events/customer/new`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:t,keyId:s,name:e,userId:o})})).ok?"success":"error"}catch(r){throw console.error(r),r instanceof Error?r.message==="Failed to fetch"?new B:new Error(r.toString()):new Error(JSON.stringify(r))}},Fe=async(...[t])=>{t.type==="Auth:Request:PostBackendCustomerEvent"&&Pe(t.data)};async function Ce(){const t=Fe,{removeListener:e}=h(t);return{removeListener:e}}const Me={listenPostBackendCustomerEventExternalRequest:Ce},U=t=>async(...[e,s])=>{e.type==="StartUp:Request:WhatsappInit"&&t(s)};async function We(t){return chrome.runtime.onMessage.addListener(U(t)),{removeListener:()=>{chrome.runtime.onMessage.removeListener(U(t))}}}const qe={listenWhatsappInitRequestRequest:We},je=async(...[t,,e])=>{if(t.type==="UsageLimit:Request:FetchBackendGetUsageLimitData")try{const s=t.data.phoneNumber??R.phoneNumber,o=await D({hasError:t.data.hasError,isBasic:t.data.isBasic,managerId:t.data.managerId,phoneNumber:s??"",planId:t.data.planId});e({type:"UsageLimit:Response:FetchBackendGetUsageLimitData",data:o})}catch(s){console.log(s),e({type:"UsageLimit:Response:FetchBackendGetUsageLimitData",data:{isExpired:!0,limits:null,status:!1}})}};async function Ge(){const t=je,{removeListener:e}=h(t);return{removeListener:e}}const Ve=async(...[t,,e])=>{if(t.type==="UsageLimit:Request:FetchBackendSyncUsageLimitData")try{const s=t.data.phoneNumber??R.phoneNumber,o=await T({extensionLimits:t.data.extensionLimits,phoneNumber:s??"",planId:t.data.planId});e({type:"UsageLimit:Response:FetchBackendSyncUsageLimitData",data:o})}catch(s){console.log(s),e({type:"UsageLimit:Response:FetchBackendSyncUsageLimitData",data:{limits:null,status:!1}})}};async function ze(){const t=Ve,{removeListener:e}=h(t);return{removeListener:e}}const Ke=async(...[t,,e])=>{if(t.type==="UsageLimit:Request:FetchBackendUsageLimitData")try{const s=t.data.phoneNumber??R.phoneNumber,o=await _({...t.data,phoneNumber:s??""});e({type:"UsageLimit:Response:FetchBackendUsageLimitData",data:o})}catch(s){console.log(s),e({type:"UsageLimit:Response:FetchBackendUsageLimitData",data:{limits:null,message:"Erro inesperado, tente novamente em alguns instantes",status:!1,errorType:"Unable to make the request"}})}};async function $e(){const t=Ke,{removeListener:e}=h(t);return{removeListener:e}}const He={listenFetchBackendUsageLimitDataExternalRequest:$e,listenFetchBackendGetUsageLimitDataExternalRequest:Ge,listenFetchBackendSyncUsageLimitDataExternalRequest:ze},Je=async(...[t,,e])=>{if(t.type==="Util:Request:GetExtensionVersion"){const s=ee();e({type:"Util:Response:GetExtensionVersion",data:s})}};async function Ye(){const t=Je,{removeListener:e}=h(t);return{removeListener:e}}const Xe=async(...[t])=>{if(t.type==="Util:Request:OpenDashboard"){chrome.runtime.openOptionsPage();const{route:e}=t.data;e&&Be.setRoute(e)}};async function Ze(){const t=Xe,{removeListener:e}=h(t);return{removeListener:e}}const Qe=async({webhook:t,data:e})=>{try{await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}catch(s){console.error(s)}},et=async(...[t])=>{t.type==="Util:Request:PostToWebhook"&&await Qe(t.data)};async function tt(){const t=et,{removeListener:e}=h(t);return{removeListener:e}}const at=async(...[t])=>{t.type==="Util:Request:WhatsappSendBeacon"&&await fetch(t.data.input,{method:"POST",body:t.data.data})};async function st(){const t=at,{removeListener:e}=h(t);return{removeListener:e}}const rt={listenGetExtensionVersionExternalRequest:Ye,listenOpenDashboardExternalRequest:Ze,listenPostToWebhookExternalRequest:tt,listenWhatsappSendBeaconExternalRequest:st},ft={auth:Ae,customerEvent:Me,startup:qe,usageLimit:He,util:rt},St=()=>`https://${Q()}.chromiumapp.org/`;export{me as C,B as F,ft as S,lt as a,mt as b,ut as c,I as d,R as e,ue as f,gt as g,pt as h,yt as i,ht as j,Be as k,St as l,h as m,de as n,Le as r,ve as s};
