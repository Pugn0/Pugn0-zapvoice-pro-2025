var Ie=Object.defineProperty;var Se=(o,n,e)=>n in o?Ie(o,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[n]=e;var D=(o,n,e)=>Se(o,typeof n!="symbol"?n+"":n,e);import{c as Re,b as K,a as k,S as Te,C as Ue}from"./chunk-DtvdEgkE.js";import{e as I,c as xe,g as Pe,d as R,b as Le,h as Ae,i as _e,j as Ne,n as Oe,a as De,l as Me,S as T,C as Ce}from"./chunk-CGJd0ITG.js";import{z as J,s as Be,t as H,u as q,w as W,x as G,y as A}from"./chunk-Oea2Ib37.js";import"./chunk-CdV9K1BU.js";function ke(){I.store.getState(),xe.store.getState(),Pe.store.getState(),R.store.getState(),Le.store.getState(),Ae.store.getState(),Re.store.getState(),_e.store.getState(),Ne.store.getState(),Oe.store.getState(),De.store.getState()}function je(){const o=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)./);return o?parseInt(o[2],10):1/0}async function fe(o,n=!1){const e=await chrome.tabs.query({}),t=e.find(s=>{var i,a;return s.active&&((i=s.url)==null?void 0:i.includes(o))&&!((a=s.favIconUrl)!=null&&a.includes("error"))})||e.find(s=>{var i;return s.active&&((i=s.url)==null?void 0:i.includes(o))});return n?t:t||e.find(s=>{var i,a;return((i=s.url)==null?void 0:i.includes(o))&&!((a=s.favIconUrl)!=null&&a.includes("error"))})||e.find(s=>{var i;return(i=s.url)==null?void 0:i.includes(o)})}class Fe{constructor(){D(this,"flagsStore",R)}async getAll(...n){return await this.flagsStore.getAll(...n)}getByName(...n){return this.flagsStore.getByName(...n)}async updateAll(...n){return await this.flagsStore.updateAll(...n)}}const Ve=["dashboard-audio-help-video","dashboard-document-help-video","dashboard-funnel-help-video","dashboard-home-help-video","dashboard-home-benefit-for-pro-video","dashboard-media-help-video","dashboard-message-help-video","dashboard-label-help-video","dashboard-trigger-help-video","dashboard-flow-help-video","dashboard-backup-help-video","tour","free-login","high-size-medias","item-scheduling","key-warning-ad","key-warning-ad-block","login-by-key","modals","news","crm","label","renew-plan-redirect","social-login","social-register","track-auth-events","track-backup-events","track-engagement-events","track-exception-events","track-funnel-events","track-item-sent-events","track-misc-events","track-page-events","track-trigger-events","trigger-webhooks","unlimited-usage","usage-limit","zap-saver","media-is-ptv","video-tutorial","redirect-uninstall-url"];var Z=function(o,n){return Z=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},Z(o,n)},p=function(){return p=Object.assign||function(o){for(var n,e=1,t=arguments.length;e<t;e++)for(var r in n=arguments[e])Object.prototype.hasOwnProperty.call(n,r)&&(o[r]=n[r]);return o},p.apply(this,arguments)};function v(o,n,e,t){return new(e||(e=Promise))(function(r,s){function i(c){try{u(t.next(c))}catch(l){s(l)}}function a(c){try{u(t.throw(c))}catch(l){s(l)}}function u(c){var l;c.done?r(c.value):(l=c.value,l instanceof e?l:new e(function(h){h(l)})).then(i,a)}u((t=t.apply(o,[])).next())})}function y(o,n){var e,t,r,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},i=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return i.next=a(0),i.throw=a(1),i.return=a(2),typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function a(u){return function(c){return function(l){if(e)throw new TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(s=0)),s;)try{if(e=1,t&&(r=2&l[0]?t.return:l[0]?t.throw||((r=t.return)&&r.call(t),0):t.next)&&!(r=r.call(t,l[1])).done)return r;switch(t=0,r&&(l=[2&l[0],r.value]),l[0]){case 0:case 1:r=l;break;case 4:return s.label++,{value:l[1],done:!1};case 5:s.label++,t=l[1],l=[0];continue;case 7:l=s.ops.pop(),s.trys.pop();continue;default:if(r=s.trys,!((r=r.length>0&&r[r.length-1])||l[0]!==6&&l[0]!==2)){s=0;continue}if(l[0]===3&&(!r||l[1]>r[0]&&l[1]<r[3])){s.label=l[1];break}if(l[0]===6&&s.label<r[1]){s.label=r[1],r=l;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(l);break}r[2]&&s.ops.pop(),s.trys.pop();continue}l=n.call(o,s)}catch(h){l=[6,h],t=0}finally{e=r=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([u,c])}}}var me={exports:{}};function X(){}X.prototype={on:function(o,n,e){var t=this.e||(this.e={});return(t[o]||(t[o]=[])).push({fn:n,ctx:e}),this},once:function(o,n,e){var t=this;function r(){t.off(o,r),n.apply(e,arguments)}return r._=n,this.on(o,r,e)},emit:function(o){for(var n=[].slice.call(arguments,1),e=((this.e||(this.e={}))[o]||[]).slice(),t=0,r=e.length;t<r;t++)e[t].fn.apply(e[t].ctx,n);return this},off:function(o,n){var e=this.e||(this.e={}),t=e[o],r=[];if(t&&n)for(var s=0,i=t.length;s<i;s++)t[s].fn!==n&&t[s].fn._!==n&&r.push(t[s]);return r.length?e[o]=r:delete e[o],this}},me.exports=X;var He=me.exports.TinyEmitter=X,C=function(o){var n=o[1];return n!=null},qe=function(o){var n=o.properties,e=n===void 0?{}:n,t=function(s,i){var a={};for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&i.indexOf(u)<0&&(a[u]=s[u]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function"){var c=0;for(u=Object.getOwnPropertySymbols(s);c<u.length;c++)i.indexOf(u[c])<0&&Object.prototype.propertyIsEnumerable.call(s,u[c])&&(a[u[c]]=s[u[c]])}return a}(o,["properties"]),r=function(s){return Object.entries(s).sort(function(i,a){var u=i[0],c=a[0];return u.localeCompare(c,void 0)})};return JSON.stringify([r(t),r(e)])},le=function(o){return v(void 0,void 0,void 0,function(){var n;return y(this,function(e){switch(e.label){case 0:n=qe(o),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,(t=n,v(void 0,void 0,void 0,function(){var r,s,i,a,u;return y(this,function(c){switch(c.label){case 0:if(r=typeof globalThis<"u"&&(!((a=globalThis.crypto)===null||a===void 0)&&a.subtle)?(u=globalThis.crypto)===null||u===void 0?void 0:u.subtle:void 0,typeof TextEncoder>"u"||!(r!=null&&r.digest)||typeof Uint8Array>"u")throw new Error("Hashing function not available");return s=new TextEncoder().encode(t),[4,r.digest("SHA-256",s)];case 1:return i=c.sent(),[2,Array.from(new Uint8Array(i)).map(function(l){return l.toString(16).padStart(2,"0")}).join("")]}})}))];case 2:return[2,e.sent()];case 3:return e.sent(),[2,n];case 4:return[2]}var t})})},We=function(){},Ge=function(){function o(n){var e=n.onError,t=n.onSent,r=n.appName,s=n.metricsInterval,i=n.disableMetrics,a=i!==void 0&&i,u=n.url,c=n.clientKey,l=n.fetch,h=n.headerName,g=n.customHeaders,b=g===void 0?{}:g,w=n.metricsIntervalInitial;this.onError=e,this.onSent=t||We,this.disabled=a,this.metricsInterval=1e3*s,this.metricsIntervalInitial=1e3*w,this.appName=r,this.url=u instanceof URL?u:new URL(u),this.clientKey=c,this.bucket=this.createEmptyBucket(),this.fetch=l,this.headerName=h,this.customHeaders=b}return o.prototype.start=function(){var n=this;if(this.disabled)return!1;typeof this.metricsInterval=="number"&&this.metricsInterval>0&&(this.metricsIntervalInitial>0?setTimeout(function(){n.startTimer(),n.sendMetrics()},this.metricsIntervalInitial):this.startTimer())},o.prototype.stop=function(){this.timer&&(clearTimeout(this.timer),delete this.timer)},o.prototype.createEmptyBucket=function(){return{start:new Date,stop:null,toggles:{}}},o.prototype.getHeaders=function(){var n,e=((n={})[this.headerName]=this.clientKey,n.Accept="application/json",n["Content-Type"]="application/json",n);return Object.entries(this.customHeaders).filter(C).forEach(function(t){var r=t[0],s=t[1];return e[r]=s}),e},o.prototype.sendMetrics=function(){return v(this,void 0,void 0,function(){var n,e,t;return y(this,function(r){switch(r.label){case 0:if(n="".concat(this.url,"/client/metrics"),e=this.getPayload(),this.bucketIsEmpty(e))return[2];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.fetch(n,{cache:"no-cache",method:"POST",headers:this.getHeaders(),body:JSON.stringify(e)})];case 2:return r.sent(),this.onSent(e),[3,4];case 3:return t=r.sent(),console.error("Unleash: unable to send feature metrics",t),this.onError(t),[3,4];case 4:return[2]}})})},o.prototype.count=function(n,e){return!(this.disabled||!this.bucket)&&(this.assertBucket(n),this.bucket.toggles[n][e?"yes":"no"]++,!0)},o.prototype.countVariant=function(n,e){return!(this.disabled||!this.bucket)&&(this.assertBucket(n),this.bucket.toggles[n].variants[e]?this.bucket.toggles[n].variants[e]+=1:this.bucket.toggles[n].variants[e]=1,!0)},o.prototype.assertBucket=function(n){if(this.disabled||!this.bucket)return!1;this.bucket.toggles[n]||(this.bucket.toggles[n]={yes:0,no:0,variants:{}})},o.prototype.startTimer=function(){var n=this;this.timer=setInterval(function(){n.sendMetrics()},this.metricsInterval)},o.prototype.bucketIsEmpty=function(n){return Object.keys(n.bucket.toggles).length===0},o.prototype.getPayload=function(){var n=p(p({},this.bucket),{stop:new Date});return this.bucket=this.createEmptyBucket(),{bucket:n,appName:this.appName,instanceId:"browser"}},o}(),ze=function(){function o(){this.store=new Map}return o.prototype.save=function(n,e){return v(this,void 0,void 0,function(){return y(this,function(t){return this.store.set(n,e),[2]})})},o.prototype.get=function(n){return v(this,void 0,void 0,function(){return y(this,function(e){return[2,this.store.get(n)]})})},o}(),Ye=function(){function o(n){n===void 0&&(n="unleash:repository"),this.prefix=n}return o.prototype.save=function(n,e){return v(this,void 0,void 0,function(){var t,r;return y(this,function(s){t=JSON.stringify(e),r="".concat(this.prefix,":").concat(n);try{window.localStorage.setItem(r,t)}catch(i){console.error(i)}return[2]})})},o.prototype.get=function(n){try{var e="".concat(this.prefix,":").concat(n),t=window.localStorage.getItem(e);return t?JSON.parse(t):void 0}catch(r){console.error(r)}},o}();let M;const Ke=new Uint8Array(16);function Je(){if(!M&&(M=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!M))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return M(Ke)}const m=[];for(let o=0;o<256;++o)m.push((o+256).toString(16).slice(1));var ce={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function Ze(o,n,e){if(ce.randomUUID&&!n&&!o)return ce.randomUUID();const t=(o=o||{}).random||(o.rng||Je)();return t[6]=15&t[6]|64,t[8]=63&t[8]|128,function(r,s=0){return m[r[s+0]]+m[r[s+1]]+m[r[s+2]]+m[r[s+3]]+"-"+m[r[s+4]]+m[r[s+5]]+"-"+m[r[s+6]]+m[r[s+7]]+"-"+m[r[s+8]]+m[r[s+9]]+"-"+m[r[s+10]]+m[r[s+11]]+m[r[s+12]]+m[r[s+13]]+m[r[s+14]]+m[r[s+15]]}(t)}var Xe=function(){function o(){}return o.prototype.generateEventId=function(){return Ze()},o.prototype.createImpressionEvent=function(n,e,t,r,s,i){var a=this.createBaseEvent(n,e,t,r,s);return i?p(p({},a),{variant:i}):a},o.prototype.createBaseEvent=function(n,e,t,r,s){return{eventType:r,eventId:this.generateEventId(),context:n,enabled:e,featureName:t,impressionData:s}},o}(),$e=["userId","sessionId","remoteAddress","currentTime"],ue=function(o){return $e.includes(o)},E={INIT:"initialized",ERROR:"error",READY:"ready",UPDATE:"update",IMPRESSION:"impression",SENT:"sent",RECOVERED:"recovered"},Qe="isEnabled",et="getVariant",tt={name:"disabled",enabled:!1,feature_enabled:!1},z="repo",de="repoLastUpdateTimestamp",rt=function(){try{if(typeof window<"u"&&"fetch"in window)return fetch.bind(window);if("fetch"in globalThis)return fetch.bind(globalThis)}catch(o){console.error('Unleash failed to resolve "fetch"',o)}},nt=function(o){function n(e){var t=e.storageProvider,r=e.url,s=e.clientKey,i=e.disableRefresh,a=i!==void 0&&i,u=e.refreshInterval,c=u===void 0?30:u,l=e.metricsInterval,h=l===void 0?30:l,g=e.metricsIntervalInitial,b=g===void 0?2:g,w=e.disableMetrics,U=w!==void 0&&w,S=e.appName,x=e.environment,_=x===void 0?"default":x,j=e.context,N=e.fetch,F=N===void 0?rt():N,Q=e.createAbortController,ee=Q===void 0?function(){try{if(typeof window<"u"&&"AbortController"in window)return function(){return new window.AbortController};if("fetch"in globalThis)return function(){return new globalThis.AbortController}}catch(O){console.error('Unleash failed to resolve "AbortController" factory',O)}}():Q,P=e.bootstrap,te=e.bootstrapOverride,be=te===void 0||te,re=e.headerName,ne=re===void 0?"Authorization":re,se=e.customHeaders,oe=se===void 0?{}:se,ie=e.impressionDataAll,we=ie!==void 0&&ie,ae=e.usePOSTrequests,Ee=ae!==void 0&&ae,L=e.experimental,d=o.call(this)||this;if(d.toggles=[],d.etag="",d.readyEventEmitted=!1,d.fetchedFromServer=!1,d.usePOSTrequests=!1,d.started=!1,!r)throw new Error("url is required");if(!s)throw new Error("clientKey is required");if(!S)throw new Error("appName is required.");return d.eventsHandler=new Xe,d.impressionDataAll=we,d.toggles=P&&P.length>0?P:[],d.url=r instanceof URL?r:new URL(r),d.clientKey=s,d.headerName=ne,d.customHeaders=oe,d.storage=t||(typeof window<"u"?new Ye:new ze),d.refreshInterval=a?0:1e3*c,d.context=p({appName:S,environment:_},j),d.usePOSTrequests=Ee,d.sdkState="initializing",d.experimental=p({},L),L!=null&&L.togglesStorageTTL&&(L==null?void 0:L.togglesStorageTTL)>0&&(d.experimental.togglesStorageTTL=1e3*L.togglesStorageTTL),d.lastRefreshTimestamp=0,d.ready=new Promise(function(O){d.init().then(O).catch(function(V){console.error(V),d.sdkState="error",d.emit(E.ERROR,V),d.lastError=V,O()})}),F||console.error('Unleash: You must either provide your own "fetch" implementation or run in an environment where "fetch" is available.'),ee||console.error('Unleash: You must either provide your own "AbortController" implementation or run in an environment where "AbortController" is available.'),d.fetch=F,d.createAbortController=ee,d.bootstrap=P&&P.length>0?P:void 0,d.bootstrapOverride=be,d.metrics=new Ge({onError:d.emit.bind(d,E.ERROR),onSent:d.emit.bind(d,E.SENT),appName:S,metricsInterval:h,disableMetrics:U,url:d.url,clientKey:s,fetch:F,headerName:ne,customHeaders:oe,metricsIntervalInitial:b}),d}return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}Z(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}(n,o),n.prototype.getAllToggles=function(){return function(e,t,r){for(var s,i=0,a=t.length;i<a;i++)!s&&i in t||(s||(s=Array.prototype.slice.call(t,0,i)),s[i]=t[i]);return e.concat(s||Array.prototype.slice.call(t))}([],this.toggles)},n.prototype.isEnabled=function(e){var t,r=this.toggles.find(function(a){return a.name===e}),s=!!r&&r.enabled;if(this.metrics.count(e,s),(r==null?void 0:r.impressionData)||this.impressionDataAll){var i=this.eventsHandler.createImpressionEvent(this.context,s,e,Qe,(t=r==null?void 0:r.impressionData)!==null&&t!==void 0?t:void 0);this.emit(E.IMPRESSION,i)}return s},n.prototype.getVariant=function(e){var t,r=this.toggles.find(function(u){return u.name===e}),s=(r==null?void 0:r.enabled)||!1,i=r?r.variant:tt;if(i.name&&this.metrics.countVariant(e,i.name),this.metrics.count(e,s),(r==null?void 0:r.impressionData)||this.impressionDataAll){var a=this.eventsHandler.createImpressionEvent(this.context,s,e,et,(t=r==null?void 0:r.impressionData)!==null&&t!==void 0?t:void 0,i.name);this.emit(E.IMPRESSION,a)}return p(p({},i),{feature_enabled:s})},n.prototype.updateToggles=function(){return v(this,void 0,void 0,function(){var e=this;return y(this,function(t){switch(t.label){case 0:return this.timerRef||this.fetchedFromServer?[4,this.fetchToggles()]:[3,2];case 1:return t.sent(),[3,4];case 2:return this.started?[4,new Promise(function(r){var s=function(){e.fetchToggles().then(function(){e.off(E.READY,s),r()})};e.once(E.READY,s)})]:[3,4];case 3:t.sent(),t.label=4;case 4:return[2]}})})},n.prototype.updateContext=function(e){return v(this,void 0,void 0,function(){var t;return y(this,function(r){switch(r.label){case 0:return(e.appName||e.environment)&&console.warn("appName and environment are static. They can't be updated with updateContext."),t={environment:this.context.environment,appName:this.context.appName,sessionId:this.context.sessionId},this.context=p(p({},t),e),[4,this.updateToggles()];case 1:return r.sent(),[2]}})})},n.prototype.getContext=function(){return p({},this.context)},n.prototype.setContextField=function(e,t){var r,s;if(ue(e))this.context=p(p({},this.context),((r={})[e]=t,r));else{var i=p(p({},this.context.properties),((s={})[e]=t,s));this.context=p(p({},this.context),{properties:i})}this.updateToggles()},n.prototype.removeContextField=function(e){var t;ue(e)?this.context=p(p({},this.context),((t={})[e]=void 0,t)):typeof this.context.properties=="object"&&delete this.context.properties[e],this.updateToggles()},n.prototype.setReady=function(){this.readyEventEmitted=!0,this.emit(E.READY)},n.prototype.init=function(){return v(this,void 0,void 0,function(){var e,t,r;return y(this,function(s){switch(s.label){case 0:return[4,this.resolveSessionId()];case 1:return e=s.sent(),this.context=p({sessionId:e},this.context),t=this,[4,this.storage.get(z)];case 2:return t.toggles=s.sent()||[],r=this,[4,this.getLastRefreshTimestamp()];case 3:return r.lastRefreshTimestamp=s.sent(),!this.bootstrap||!this.bootstrapOverride&&this.toggles.length!==0?[3,6]:[4,this.storage.save(z,this.bootstrap)];case 4:return s.sent(),this.toggles=this.bootstrap,this.sdkState="healthy",[4,this.storeLastRefreshTimestamp()];case 5:s.sent(),this.setReady(),s.label=6;case 6:return this.sdkState="healthy",this.emit(E.INIT),[2]}})})},n.prototype.start=function(){return v(this,void 0,void 0,function(){var e,t=this;return y(this,function(r){switch(r.label){case 0:return this.started=!0,this.timerRef?(console.error("Unleash SDK has already started, if you want to restart the SDK you should call client.stop() before starting again."),[2]):[4,this.ready];case 1:return r.sent(),this.metrics.start(),e=this.refreshInterval,[4,this.initialFetchToggles()];case 2:return r.sent(),e>0&&(this.timerRef=setInterval(function(){return t.fetchToggles()},e)),[2]}})})},n.prototype.stop=function(){this.timerRef&&(clearInterval(this.timerRef),this.timerRef=void 0),this.metrics.stop()},n.prototype.isReady=function(){return this.readyEventEmitted},n.prototype.getError=function(){return this.sdkState==="error"?this.lastError:void 0},n.prototype.sendMetrics=function(){return this.metrics.sendMetrics()},n.prototype.resolveSessionId=function(){return v(this,void 0,void 0,function(){var e;return y(this,function(t){switch(t.label){case 0:return this.context.sessionId?[2,this.context.sessionId]:[4,this.storage.get("sessionId")];case 1:return(e=t.sent())?[3,3]:(e=Math.floor(1e9*Math.random()),[4,this.storage.save("sessionId",e.toString(10))]);case 2:t.sent(),t.label=3;case 3:return[2,e.toString(10)]}})})},n.prototype.getHeaders=function(){var e,t=this.usePOSTrequests,r=((e={})[this.headerName]=this.clientKey,e.Accept="application/json",e);return t&&(r["Content-Type"]="application/json"),this.etag&&(r["If-None-Match"]=this.etag),Object.entries(this.customHeaders).filter(C).forEach(function(s){var i=s[0],a=s[1];return r[i]=a}),r},n.prototype.storeToggles=function(e){return v(this,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return this.toggles=e,this.emit(E.UPDATE),[4,this.storage.save(z,e)];case 1:return t.sent(),[2]}})})},n.prototype.isTogglesStorageTTLEnabled=function(){var e;return!!(!((e=this.experimental)===null||e===void 0)&&e.togglesStorageTTL&&this.experimental.togglesStorageTTL>0)},n.prototype.isUpToDate=function(){var e;if(!this.isTogglesStorageTTLEnabled())return!1;var t=Date.now(),r=((e=this.experimental)===null||e===void 0?void 0:e.togglesStorageTTL)||0;return this.lastRefreshTimestamp>0&&this.lastRefreshTimestamp<=t&&t-this.lastRefreshTimestamp<=r},n.prototype.getLastRefreshTimestamp=function(){return v(this,void 0,void 0,function(){var e,t;return y(this,function(r){switch(r.label){case 0:return this.isTogglesStorageTTLEnabled()?[4,this.storage.get(de)]:[3,3];case 1:return e=r.sent(),[4,le(this.context)];case 2:return t=r.sent(),[2,(e==null?void 0:e.key)===t?e.timestamp:0];case 3:return[2,0]}})})},n.prototype.storeLastRefreshTimestamp=function(){return v(this,void 0,void 0,function(){var e,t;return y(this,function(r){switch(r.label){case 0:return this.isTogglesStorageTTLEnabled()?(this.lastRefreshTimestamp=Date.now(),t={},[4,le(this.context)]):[3,3];case 1:return t.key=r.sent(),t.timestamp=this.lastRefreshTimestamp,e=t,[4,this.storage.save(de,e)];case 2:r.sent(),r.label=3;case 3:return[2]}})})},n.prototype.initialFetchToggles=function(){if(!this.isUpToDate())return this.fetchToggles();this.fetchedFromServer||(this.fetchedFromServer=!0,this.setReady())},n.prototype.fetchToggles=function(){return v(this,void 0,void 0,function(){var e,t,r,s,i,a,u,c,l;return y(this,function(h){switch(h.label){case 0:if(!this.fetch)return[3,9];this.abortController&&this.abortController.abort(),this.abortController=(l=this.createAbortController)===null||l===void 0?void 0:l.call(this),e=this.abortController?this.abortController.signal:void 0,h.label=1;case 1:return h.trys.push([1,7,8,9]),t=this.usePOSTrequests,r=t?this.url:function(g,b){var w=new URL(g.toString());return Object.entries(b).filter(C).forEach(function(U){var S=U[0],x=U[1];S==="properties"&&x?Object.entries(x).filter(C).forEach(function(_){var j=_[0],N=_[1];return w.searchParams.append("properties[".concat(j,"]"),N)}):w.searchParams.append(S,x)}),w}(this.url,this.context),s=t?"POST":"GET",i=t?JSON.stringify({context:this.context}):void 0,[4,this.fetch(r.toString(),{method:s,cache:"no-cache",headers:this.getHeaders(),body:i,signal:e})];case 2:return a=h.sent(),this.sdkState==="error"&&a.status<400&&(this.sdkState="healthy",this.emit(E.RECOVERED)),a.ok?(this.etag=a.headers.get("ETag")||"",[4,a.json()]):[3,5];case 3:return u=h.sent(),[4,this.storeToggles(u.toggles)];case 4:return h.sent(),this.sdkState!=="healthy"&&(this.sdkState="healthy"),this.fetchedFromServer||(this.fetchedFromServer=!0,this.setReady()),this.storeLastRefreshTimestamp(),[3,6];case 5:a.status===304?this.storeLastRefreshTimestamp():(console.error("Unleash: Fetching feature toggles did not have an ok response"),this.sdkState="error",this.emit(E.ERROR,{type:"HttpError",code:a.status}),this.lastError={type:"HttpError",code:a.status}),h.label=6;case 6:return[3,9];case 7:return typeof(c=h.sent())=="object"&&c!==null&&"name"in c&&c.name==="AbortError"||(console.error("Unleash: unable to fetch feature toggles",c),this.sdkState="error",this.emit(E.ERROR,c),this.lastError=c),[3,9];case 8:return this.abortController=null,[7];case 9:return[2]}})})},n}(He);const ge=new Fe,st={url:J("==Aa0RHczpzLvU3cuEGcw5SduxWZhNHatg2bzRXZk5yYv12L1NHZkBDMxAzLhBXavYmcv5Gdl5GZ"),appName:"zap-voice",clientKey:J("kVmZhVHb0pDcy9GZ1NGdp9mbukTY0EjZ3EzMjZGZjljNlNjYmVWZzkDOlRTO4YWY0UGM5UWM4EmY1UDMjVDM3ETMwIWN2EWZmNTM"),refreshInterval:1*60*60*24,disableMetrics:!0},f=new nt(st);f.on("ready",async()=>{await ve()});f.on("update",async()=>{await ve()});f.on("error",async()=>{console.error("Unleash error"),f.stop(),await ge.updateAll(Be.flags),setTimeout(()=>{f.start()},1e4)});const ve=async()=>{let o={};o=Ve.reduce((n,e)=>{if(e==="key-warning-ad-block"){const t=f.getVariant(e);if(!t.enabled)n[e]=H;else if(t.payload&&t.payload.type==="json"){const r=t.payload.value;try{const s=JSON.parse(r),i=s.banner&&typeof s.banner.actionButtonLink=="string"&&typeof s.banner.actionButtonText=="string"&&typeof s.banner.cancelText=="string"&&typeof s.banner.description=="string"&&typeof s.banner.title=="string",a=s.popup&&typeof s.popup.actionButtonLink=="string"&&typeof s.popup.actionButtonText=="string"&&typeof s.popup.cancelText1=="string"&&typeof s.popup.cancelText2=="string"&&typeof s.popup.description=="object"&&typeof s.popup.title1=="string"&&typeof s.popup.title2=="string"&&typeof s.popup.showCountdown=="boolean"&&typeof s.popup.videoLink=="string",u=typeof s.max_date=="string"||s.max_date===null;if(!(i&&u&&a))throw new Error;n[e]={enabled:f.isEnabled(e),payload:s}}catch(s){n[e]=H,console.warn(`Invalid payload for flag key-warning-ad-block

`,s)}}else n[e]=H,console.warn("Invalid payload for flag key-warning-ad-block")}else if(e==="modals"){const t=f.getVariant(e);if(!t.enabled)n[e]=q;else if(t.payload&&t.payload.type==="json"){const r=t.payload.value;try{const i=JSON.parse(r).filter(a=>{const u=!!a.id,c=!!a.version,l=!!a.title,h=!!a.afterDescription,g=!!a.beforeDescription,b=!!a.subTitle;return u&&c&&l&&(h||g||b)});n[e]={enabled:f.isEnabled(e),payload:i}}catch(s){n[e]=q,console.warn(`Invalid payload for flag modals

`,s)}}else n[e]=q,console.warn("Invalid payload for flag modals")}else if(e==="news"){const t=f.getVariant(e);if(!t.enabled)n[e]=W;else if(t.payload&&t.payload.type==="json"){const r=t.payload.value;try{const i=JSON.parse(r).filter(a=>{const u=!!a.id,c=!!a.title,l=!!a.description;return u&&c&&l});n[e]={enabled:f.isEnabled(e),payload:i}}catch(s){n[e]=W,console.warn(`Invalid payload for flag news

`,s)}}else n[e]=W,console.warn("Invalid payload for flag news")}else if(e==="dashboard-audio-help-video"||e==="dashboard-backup-help-video"||e==="dashboard-document-help-video"||e==="dashboard-flow-help-video"||e==="dashboard-funnel-help-video"||e==="dashboard-home-help-video"||e==="dashboard-label-help-video"||e==="dashboard-media-help-video"||e==="dashboard-message-help-video"||e==="dashboard-trigger-help-video"||e==="dashboard-home-benefit-for-pro-video"||e==="video-tutorial"){const t=f.getVariant(e);if(!t.enabled)n[e]=G;else if(t.payload&&t.payload.type==="json"){const r=t.payload.value;try{const s=JSON.parse(r);if(!s["video-url"]&&!s.modal)throw new Error("No video-url or modal");e==="dashboard-home-benefit-for-pro-video"||e==="video-tutorial"?n[e]={enabled:f.isEnabled(e),payload:{"video-url":s["video-url"]}}:n[e]={enabled:f.isEnabled(e),payload:{"video-url":s["video-url"],modal:s.modal}}}catch(s){n[e]=G,console.warn(`Invalid payload for flag ${e}

`,s)}}else n[e]=G,console.warn(`Invalid payload for flag ${e}`)}else if(e==="redirect-uninstall-url"){const t=f.getVariant(e);if(!t.enabled)n[e]=A;else if(t.payload&&t.payload.type==="json"){const r=t.payload.value;try{const s=JSON.parse(r);if(!s.baseUrl||s.enableDynamicParamsInBaseUrl===void 0)throw new Error("No baseUrl or enableDynamicParamsInBaseUrl");n[e]={baseUrl:s.baseUrl,enableDynamicParamsInBaseUrl:s.enableDynamicParamsInBaseUrl}}catch(s){n[e]=A,console.warn(`Invalid payload for redirect-uninstall-url

`,s)}}else n[e]=A,console.warn("Invalid payload for redirect-uninstall-url")}else n[e]=f.isEnabled(e);return n},{}),await ge.updateAll(o)};let Y=!1;const ye=async o=>{Y||(Y=!0,await f.updateContext({userId:o??void 0}),Y=!1)},ot=async o=>{await ye(o),await f.start()},it=`${J("oRHdwNnOv8SYwBnL6FGc29WajVmLj9WbuImc")}/unauthorized/special-register/step2`;class he{constructor(n){D(this,"interval",null);D(this,"tries",0);this.options=n}clear(){this.interval&&clearInterval(this.interval),this.tries=0}start(){this.clear(),this.interval=setInterval(async()=>{if(this.tries+=1,this.tries>=this.options.maxTries)return this.clear();const n=R.flags["usage-limit"],{authError:e,isPremium:t}=await I.refreshPremium(n);if(!e&&t)return this.clear()},this.options.msBetweenTries)}}ke();const pe=chrome.runtime.getManifest(),B=pe.version_name||pe.version,$=chrome.runtime.id;setTimeout(async()=>{await K.clear()},0);chrome.tabs.onRemoved.addListener(async(o,n)=>{if(n.isWindowClosing)return await K.clear();const e=await k(),t=await fe(chrome.runtime.getURL("dashboard.html"));if(!e&&!t)return await K.clear()});chrome.tabs.onUpdated.addListener(async(o,n,e)=>{var u;const{status:t,url:r}=e;if(n.status==="complete"&&t==="complete"&&(r!=null&&r.startsWith(it))){const c=new URL(r).searchParams,l=c.get("key"),h=c.get("keyId"),g=c.get("managerId"),b=c.get("ownerId"),w=R.flags["usage-limit"];l&&h&&g&&b&&await I.login({key:l,keyId:h,managerId:g,ownerId:b,shouldGetUsage:w})}if(n.status==="complete"&&t==="complete"&&(r!=null&&r.startsWith("https://zapvoice.com.br/pagina-obrigado"))&&new he({maxTries:12,msBetweenTries:2e4}).start(),n.status==="complete"&&t==="complete"&&(r!=null&&r.startsWith("https://pay.zapvoice.com.br/invoice"))&&new he({maxTries:10,msBetweenTries:9e4}).start(),n.status!=="loading")return;const a=Me();if((u=e.url)!=null&&u.startsWith(a)){const c=new URL(e.url).searchParams,l=c.get("key"),h=c.get("keyId"),g=c.get("managerId"),b=c.get("ownerId");chrome.tabs.remove(o);const w=R.flags["usage-limit"];if(l&&h&&g&&b){const U=await I.login({key:l,keyId:h,managerId:g,ownerId:b,shouldGetUsage:w});fe(chrome.runtime.getURL("")).then(S=>{S!=null&&S.id&&(Te.auth.sendFinishExternalLoginRequest(U),chrome.tabs.update(S.id,{active:!0,highlighted:!0}))})}}});chrome.runtime.onInstalled.addListener(async o=>{const n=o.reason===chrome.runtime.OnInstalledReason.INSTALL,e=o.reason===chrome.runtime.OnInstalledReason.UPDATE;if(n||e){const t=await k();t!=null&&t.id?chrome.tabs.reload(t.id):chrome.tabs.create({url:"https://web.whatsapp.com",active:!0})}if(n){const t=new URL("https://zapvoice.com.br/install-page");t.searchParams.append("utm_source","chrome_extension"),t.searchParams.append("utm_medium","install_page"),t.searchParams.append("utm_campaign",$),t.searchParams.append("utm_id",B),chrome.tabs.create({url:t.toString()})}});chrome.runtime.onUpdateAvailable.addListener(()=>{chrome.runtime.reload()});T.startup.listenWhatsappInitRequestRequest(o=>{var t;if(je()<102)return;function e(r){chrome.scripting.executeScript({files:["static/js/importLoader/index.js"],target:{tabId:r,allFrames:!0},world:"MAIN"})}(t=o.tab)!=null&&t.id?e(o.tab.id):k(!0).then(r=>{r!=null&&r.id&&e(r.id)})});const at=async o=>{const n=Object.keys(o),e=await k();e!=null&&e.id&&chrome.tabs.sendMessage(e.id,{type:"INFO_SW_STORE_CHANGED",data:{topics:n}}).catch(t=>{console.log(t)})};Ue.addChromeStorageListener(at);I.addListener(async()=>{const o=I.wppVersion??"",n=I.phoneNumber??"",e=I.key??"",{baseUrl:t,enableDynamicParamsInBaseUrl:r}=R.flags["redirect-uninstall-url"],s=new URL(t??A.baseUrl);(t===A.baseUrl||r)&&(s.searchParams.append("extensionId",$),s.searchParams.append("key",e),s.searchParams.append("phoneNumber",n),s.searchParams.append("version",B),s.searchParams.append("wppVersion",o),s.searchParams.append("utm_source","chrome_extension"),s.searchParams.append("utm_medium","uninstall_button"),s.searchParams.append("utm_campaign",$),s.searchParams.append("utm_id",B)),chrome.runtime.setUninstallURL(s.toString());const i=JSON.stringify(R.getByName("key-warning-ad-block"));await ye(I.key);const a=JSON.stringify(R.getByName("key-warning-ad-block"));if(i!==a){const u=R.flags["usage-limit"];I.refreshPremium(u)}});setTimeout(async()=>{ot(I.key)},3e3);const lt=new Ce;lt.setTrackerUserProperties({zapvoiceVersion:B??null});T.auth.listenFetchBackendAuthDataExternalRequest();T.util.listenGetExtensionVersionExternalRequest();T.util.listenOpenDashboardExternalRequest();T.util.listenPostToWebhookExternalRequest();T.util.listenWhatsappSendBeaconExternalRequest();T.customerEvent.listenPostBackendCustomerEventExternalRequest();T.usageLimit.listenFetchBackendUsageLimitDataExternalRequest();T.usageLimit.listenFetchBackendGetUsageLimitDataExternalRequest();T.usageLimit.listenFetchBackendSyncUsageLimitDataExternalRequest();setInterval(async()=>{const o=R.flags["usage-limit"];await I.refreshPremium(o)},1e3*60*60*24);
